import{m as r,a2 as W,j as e,a3 as se,a7 as te,ac as re}from"./index-BSbyIc-9.js";import{g as ae,d as ne,r as d,L as C}from"./router-DHx2Xk7F.js";import{c as R,h as P,m as F,q as v,w as l,f as g,k as J,j as V,A as E,x as T}from"./firebase-DBzIg5Y3.js";import{C as ie}from"./modal-xT3RH5lH.js";import{F as le}from"./CalendarIcon-BrVDZ9nH.js";import{F as oe}from"./ChartBarIcon-BixXk3V1.js";import"./vendor-DJG_os-6.js";const pe=()=>{const{id:t}=ae(),c=ne(),[Q,m]=d.useState(!0),[S,D]=d.useState(!1),[w,i]=d.useState(null),[s,O]=d.useState(null),[Y,G]=d.useState(""),[$,b]=d.useState(!1),[z,p]=d.useState(!1),[H,L]=d.useState(!1),[M,N]=d.useState(null),[K,k]=d.useState(!1),[A,q]=d.useState(!1);d.useEffect(()=>{if(!t||!r.currentUser){c("/leagues");return}if(W(r.currentUser)){c(`/leagues/${t}`);return}(async()=>{const n=R(),u=v(g(n,"leagueMemberships"),l("leagueId","==",t),l("userId","==",r.currentUser.uid),l("status","==","active"));if(!(await J(u)).empty){c(`/leagues/${t}`);return}})(),m(!0),i(null);const a=R(),f=P(a,"leagues",t),x=F(f,n=>{if(!n.exists()){i("League not found"),m(!1);return}const u={id:n.id,...n.data()};O(u)},n=>{console.error("Error fetching league data:",n),i("Failed to load league data"),m(!1)}),y=v(g(a,"leagueMemberships"),l("leagueId","==",t),l("userId","==",r.currentUser.uid)),B=F(y,n=>{if(!n.empty){const u=n.docs[0].data();if(u.status==="active"){b(!0),p(!1),m(!1),N(3);const j=setInterval(()=>{N(h=>h===null||h<=1?(clearInterval(j),c(`/leagues/${t}`),null):h-1)},1e3);return}else if(u.status==="inactive"){b(!1),p(!1),L(!0),m(!1);return}else if(u.status==="pending"){b(!1),p(!0),m(!1);return}}b(!1),L(!1)}),U=v(g(a,"leagueJoinRequests"),l("leagueId","==",t),l("userId","==",r.currentUser.uid),l("status","==","pending")),I=F(U,n=>{p(!n.empty),m(!1)});return()=>{x(),B(),I()}},[t,c]);const X=async o=>{if(o.preventDefault(),!t||!r.currentUser||!s){i("You must be logged in to reactivate membership");return}s.settings?.pricing?.paymentRequired===!0?q(!0):i("Free league reactivation is not yet implemented. Please contact an administrator.")},Z=async o=>{if(o.preventDefault(),!t||!r.currentUser||!s){i("You must be logged in to join a league");return}if($){c(`/leagues/${t}`);return}if(z){i("You already have a pending request to join this league");return}if(!s.isPublic&&s.createdBy!==r.currentUser.uid&&!W(r.currentUser)){i("This is a private league. You can only join by invitation.");return}const a=R(),f=await V(P(a,"users",r.currentUser.uid));if(!f.exists()){i("User profile not found");return}const x=f.data(),y=x.username||x.displayName;if(y){const U=v(g(a,"leagueMemberships"),l("leagueId","==",t),l("status","==","active")),I=await J(U);for(const n of I.docs){const u=n.data(),j=await V(P(a,"users",u.userId));if(j.exists()){const h=j.data();if((h.username||h.displayName)===y){i(`A member with username "${y}" is already in this league`);return}}}}s.settings?.pricing?.paymentRequired===!0?q(!0):k(!0)},_=()=>{q(!1),b(!0),L(!1),N(3);const o=setInterval(()=>{N(a=>a===null||a<=1?(clearInterval(o),c(`/leagues/${t}`),null):a-1)},1e3)},ee=async()=>{if(!t||!r.currentUser||!s){i("You must be logged in to join a league");return}const o=R(),a=v(g(o,"leagueJoinRequests"),l("leagueId","==",t),l("userId","==",r.currentUser.uid),l("status","==","pending"));if(!(await J(a)).empty){p(!0),i("You already have a pending request to join this league"),k(!1);return}D(!0),i(null),k(!1);try{s.settings.allowJoinRequests?await E(g(o,"leagueJoinRequests"),{leagueId:t,userId:r.currentUser.uid,requestedAt:T(),status:"pending",message:Y}):await E(g(o,"leagueMemberships"),{leagueId:t,userId:r.currentUser.uid,joinedAt:T(),status:"active",role:"player",stats:{gamesPlayed:0,gamesWon:0,totalPoints:0,winRate:0,currentStreak:0,longestWinStreak:0}})}catch(x){console.error("Error joining league:",x)}finally{D(!1)}};return Q?e.jsx("div",{className:"flex h-full items-center justify-center",children:e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-t-2 border-b-2 border-blue-500"})}):w||!s?e.jsxs("div",{className:"p-6 max-w-6xl mx-auto",children:[e.jsx("div",{className:"bg-red-100 border-l-4 border-red-500 p-4 mb-4",children:e.jsx("div",{className:"flex",children:e.jsx("div",{className:"ml-3",children:e.jsx("p",{className:"text-red-700",children:w||"League not found"})})})}),e.jsx(C,{to:"/leagues",className:"text-blue-600 hover:underline",children:"← Back to Leagues"})]}):e.jsxs("div",{className:"p-6 max-w-6xl mx-auto dark:text-white",children:[e.jsxs("h1",{className:"text-2xl font-bold mb-6 flex items-center",children:[e.jsx(se,{className:"h-7 w-7 mr-2 text-blue-500"}),"Join League: ",s.name]}),e.jsxs("div",{className:"bg-white dark:bg-zinc-800 rounded-lg shadow p-6 mb-6",children:[e.jsx("h2",{className:"text-xl font-semibold mb-4",children:"League Information"}),e.jsx("p",{className:"text-gray-700 dark:text-gray-300 mb-4",children:s.description}),s.settings?.pricing?.paymentRequired&&e.jsxs("div",{className:"bg-gradient-to-r from-green-50 to-emerald-50 dark:from-green-900/20 dark:to-emerald-900/20 border border-green-200 dark:border-green-800 rounded-lg p-4 mb-4",children:[e.jsxs("div",{className:"flex items-center mb-2",children:[e.jsx("svg",{className:"h-5 w-5 text-green-600 dark:text-green-400 mr-2",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 8c-1.657 0-3 .895-3 2s1.343 2 3 2 3 .895 3 2-1.343 2-3 2m0-8c1.11 0 2.08.402 2.599 1M12 8V7m0 1v8m0 0v1m0-1c-1.11 0-2.08-.402-2.599-1"})}),e.jsx("span",{className:"font-semibold text-green-700 dark:text-green-300",children:"Premium League"})]}),e.jsxs("div",{className:"text-sm text-green-600 dark:text-green-400",children:[e.jsxs("p",{className:"mb-2",children:[e.jsx("strong",{className:"text-2xl font-bold",children:new Intl.NumberFormat("en-US",{style:"currency",currency:s.settings.pricing.currency||"USD"}).format(s.settings.pricing.monthlyFee)}),e.jsx("span",{className:"text-sm ml-1",children:"/month"})]}),e.jsx("p",{className:"text-xs text-green-600 dark:text-green-400",children:"Monthly membership fee required to join and participate in this league. Payment is processed securely through Square using credit cards, Apple Pay, or Google Pay."})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4 mb-4",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-medium mb-2",children:"Details"}),e.jsxs("ul",{className:"space-y-2 text-gray-700 dark:text-gray-300",children:[e.jsxs("li",{className:"flex items-center",children:[e.jsx(te,{className:"h-5 w-5 mr-2 text-gray-500"}),e.jsxs("span",{children:[s.stats?.totalMembers||0," members"]})]}),e.jsxs("li",{className:"flex items-center",children:[e.jsx(le,{className:"h-5 w-5 mr-2 text-gray-500"}),e.jsxs("span",{children:["Created"," ",s.createdAt?new Date(s.createdAt.toDate()).toLocaleDateString():"Unknown"]})]}),e.jsxs("li",{className:"flex items-center",children:[e.jsx(oe,{className:"h-5 w-5 mr-2 text-gray-500"}),e.jsxs("span",{children:[s.settings?.gameMode==="double"?"Team":"Individual"," ","mode • ",s.settings?.pointsToWin||100," points"]})]}),e.jsx("li",{className:"flex items-center",children:s.isPublic?e.jsxs(e.Fragment,{children:[e.jsx("svg",{className:"h-5 w-5 mr-2 text-blue-500",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M3.055 11H5a2 2 0 012 2v1a2 2 0 002 2 2 2 0 012 2v2.945M8 3.935V5.5A2.5 2.5 0 0010.5 8h.5a2 2 0 012 2 2 2 0 104 0 2 2 0 012-2h1.064M15 20.488V18a2 2 0 012-2h3.064M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})}),e.jsx("span",{className:"text-blue-600 dark:text-blue-400",children:"Public League - Anyone can join"})]}):e.jsxs(e.Fragment,{children:[e.jsx("svg",{className:"h-5 w-5 mr-2 text-purple-500",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 15v2m-6 4h12a2 2 0 002-2v-6a2 2 0 00-2-2H6a2 2 0 00-2 2v6a2 2 0 002 2zm10-10V7a4 4 0 00-8 0v4h8z"})}),e.jsx("span",{className:"text-purple-600 dark:text-purple-400",children:"Private League - Invitation only"})]})})]})]}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-medium mb-2",children:"Game Settings"}),e.jsxs("ul",{className:"space-y-2 text-gray-700 dark:text-gray-300",children:[e.jsxs("li",{children:[e.jsx("strong",{children:"Format:"})," ",s.settings?.tournamentFormat?s.settings.tournamentFormat.replace("-"," "):"Standard"]}),e.jsxs("li",{children:[e.jsx("strong",{children:"Rounds:"})," ",s.settings?.numberOfRounds||0]}),e.jsxs("li",{children:[e.jsx("strong",{children:"Points System:"})," ",s.settings?.scoringSystem?.pointsPerWin||0," pts win /"," ",s.settings?.scoringSystem?.pointsPerDraw||0," pts draw"]})]})]})]})]}),e.jsx("div",{className:"bg-white dark:bg-zinc-800 rounded-lg shadow p-6",children:$?e.jsxs("div",{className:"text-center py-8",children:[e.jsxs("div",{className:"mb-4",children:[e.jsx("div",{className:"w-16 h-16 bg-green-100 dark:bg-green-900/30 rounded-full flex items-center justify-center mx-auto mb-4",children:e.jsx("svg",{className:"w-8 h-8 text-green-600 dark:text-green-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M5 13l4 4L19 7"})})}),e.jsx("h2",{className:"text-xl font-semibold mb-2 text-green-700 dark:text-green-300",children:"You are already a member of this league!"}),e.jsx("p",{className:"text-gray-600 dark:text-gray-400 mb-4",children:"You have full access to view league details, participate in games, and compete with other members."}),M!==null&&e.jsx("div",{className:"bg-blue-50 dark:bg-blue-900/20 border border-blue-200 dark:border-blue-800 rounded-md px-4 py-3 mb-4 inline-block",children:e.jsxs("p",{className:"text-blue-700 dark:text-blue-300 text-sm",children:["Redirecting to league page in ",M," second",M!==1?"s":"","..."]})})]}),e.jsxs("div",{className:"flex justify-center space-x-3",children:[e.jsx("button",{onClick:()=>c(`/leagues/${t}`),className:"px-6 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700 transition-colors",children:"Go to League Now"}),e.jsx("button",{onClick:()=>c("/leagues"),className:"px-6 py-2 bg-gray-200 text-gray-800 rounded-md hover:bg-gray-300 dark:bg-zinc-700 dark:text-gray-200 dark:hover:bg-zinc-600 transition-colors",children:"Back to All Leagues"})]})]}):H?e.jsxs("div",{className:"text-center py-8",children:[e.jsxs("div",{className:"mb-4",children:[e.jsx("div",{className:"w-16 h-16 bg-red-100 dark:bg-red-900/30 rounded-full flex items-center justify-center mx-auto mb-4",children:e.jsx("svg",{className:"w-8 h-8 text-red-600 dark:text-red-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-2.5L13.732 4c-.77-.833-1.964-.833-2.732 0L4.082 15.5c-.77.833.192 2.5 1.732 2.5z"})})}),e.jsx("h2",{className:"text-xl font-semibold mb-2 text-red-700 dark:text-red-300",children:"Your membership is currently inactive"}),e.jsxs("p",{className:"text-gray-600 dark:text-gray-400 mb-4",children:["You are a member of this league but your membership has expired or been deactivated.",s.settings?.pricing?.paymentRequired?" You can reactivate your membership by making a payment below.":" Please contact the league administrator to reactivate your membership."]}),s.settings?.pricing?.paymentRequired&&e.jsx("div",{className:"bg-gradient-to-r from-green-50 to-emerald-50 dark:from-green-900/20 dark:to-emerald-900/20 border border-green-200 dark:border-green-800 rounded-lg p-4 mb-4 max-w-md mx-auto",children:e.jsxs("div",{className:"text-sm text-green-600 dark:text-green-400",children:[e.jsxs("p",{className:"mb-2",children:[e.jsx("strong",{className:"text-2xl font-bold",children:new Intl.NumberFormat("en-US",{style:"currency",currency:s.settings.pricing.currency||"USD"}).format(s.settings.pricing.monthlyFee)}),e.jsx("span",{className:"text-sm ml-1",children:"/month"})]}),e.jsx("p",{className:"text-xs text-green-600 dark:text-green-400",children:"Pay to reactivate your membership and continue participating in the league."})]})})]}),e.jsxs("div",{className:"flex justify-center space-x-3",children:[s.settings?.pricing?.paymentRequired?e.jsx("form",{onSubmit:X,children:e.jsxs("button",{type:"submit",className:"px-6 py-2 bg-green-600 text-white rounded-md hover:bg-green-700 transition-colors",children:["Pay ",new Intl.NumberFormat("en-US",{style:"currency",currency:s.settings.pricing.currency||"USD"}).format(s.settings.pricing.monthlyFee)," to Reactivate"]})}):e.jsx("button",{disabled:!0,className:"px-6 py-2 bg-gray-300 text-gray-500 rounded-md cursor-not-allowed",children:"Contact Administrator"}),e.jsx("button",{onClick:()=>c(`/leagues/${t}`),className:"px-6 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700 transition-colors",children:"View League Details"})]})]}):z?e.jsxs("div",{className:"text-center py-6",children:[e.jsx("h2",{className:"text-xl font-semibold mb-2",children:"Your request to join is pending"}),e.jsx("p",{className:"text-gray-600 dark:text-gray-400 mb-4",children:"Your request has been submitted and is awaiting approval. The league administrator will review your request soon."}),e.jsx("div",{className:"flex justify-center",children:e.jsxs("div",{className:"bg-yellow-50 dark:bg-yellow-900/20 border border-yellow-200 dark:border-yellow-800 rounded-md px-4 py-3 flex items-center",children:[e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5 text-yellow-500 mr-2",viewBox:"0 0 20 20",fill:"currentColor",children:e.jsx("path",{fillRule:"evenodd",d:"M10 18a8 8 0 100-16 8 8 0 000 16zm1-12a1 1 0 10-2 0v4a1 1 0 00.293.707l2.828 2.829a1 1 0 101.415-1.415L11 9.586V6z",clipRule:"evenodd"})}),e.jsx("span",{className:"text-yellow-700 dark:text-yellow-400",children:"Request pending approval"})]})}),e.jsx("div",{className:"mt-4",children:e.jsx(C,{to:`/leagues/${t}`,className:"px-4 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700",children:"View League"})})]}):e.jsxs("form",{onSubmit:Z,children:[e.jsx("h2",{className:"text-xl font-semibold mb-4",children:"Join Request"}),w&&e.jsx("div",{className:"bg-red-50 border-l-4 border-red-500 p-4 mb-4 dark:bg-red-900/20",children:e.jsx("p",{className:"text-red-700 dark:text-red-300",children:w})}),s.settings?.allowJoinRequests&&e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{htmlFor:"joinMessage",className:"block text-sm font-medium mb-1",children:"Message (Optional)"}),e.jsx("textarea",{id:"joinMessage",value:Y,onChange:o=>G(o.target.value),placeholder:"Introduce yourself to the league administrators",className:"w-full p-2 border border-gray-300 rounded-md focus:outline-none focus:ring-blue-500 focus:border-blue-500 dark:bg-zinc-700 dark:border-zinc-600",rows:3}),e.jsx("p",{className:"mt-1 text-sm text-gray-500",children:s.settings?.allowJoinRequests?"Your request will need to be approved by a league administrator.":"You will be added to the league immediately."})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx(C,{to:`/leagues/${t}`,className:"px-4 py-2 bg-gray-200 text-gray-800 rounded-md hover:bg-gray-300 dark:bg-zinc-700 dark:text-gray-200 dark:hover:bg-zinc-600",children:"Cancel"}),e.jsx("button",{type:"submit",disabled:S,className:`px-4 py-2 rounded-md font-medium ${S?"bg-gray-300 text-gray-500 cursor-not-allowed dark:bg-zinc-700 dark:text-zinc-400":"bg-green-600 text-white hover:bg-green-700"}`,children:S?"Processing...":s.settings?.pricing?.paymentRequired?`Pay ${new Intl.NumberFormat("en-US",{style:"currency",currency:s.settings.pricing.currency||"USD"}).format(s.settings.pricing.monthlyFee)} to Join`:s.settings?.allowJoinRequests?"Submit Request to Join":"Join League"})]})]})}),e.jsx(ie,{isOpen:K,onClose:()=>k(!1),onConfirm:ee,title:"Confirm Join League",message:`Are you sure you want to join "${s?.name}"? ${s?.settings?.allowJoinRequests?"Your request will be sent to the league administrators for approval.":"You will be added to the league immediately."}`,confirmText:s?.settings?.allowJoinRequests?"Send Request":"Join League",confirmButtonClass:"bg-blue-600 hover:bg-blue-700 text-white"}),A&&s?.settings?.pricing?.paymentRequired&&e.jsx(re,{isOpen:A,onClose:()=>q(!1),leagueId:t,leagueName:s.name,monthlyFee:s.settings.pricing.monthlyFee,currency:s.settings.pricing.currency||"USD",userId:r.currentUser?.uid,onSuccess:_})]})};export{pe as default};
