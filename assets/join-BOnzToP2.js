import{A as H,i as Z,r as l,q as r,ae as P,m as N,o as J,I as C,Y as f,Z as n,_ as m,j as e,P as I,af as _,an as K,as as U,n as A,at as B,ak as W}from"./index-BJ8C48to.js";import{C as X}from"./modal-C8HcxHT9.js";import{F as ee}from"./CalendarIcon-CTwdWkec.js";import{F as se}from"./ChartBarIcon-DWfFvSAB.js";const ie=()=>{const{id:t}=H(),u=Z(),[E,g]=l.useState(!0),[k,D]=l.useState(!1),[j,i]=l.useState(null),[s,T]=l.useState(null),[z,Q]=l.useState(""),[F,R]=l.useState(!1),[Y,y]=l.useState(!1),[q,$]=l.useState(null),[V,w]=l.useState(!1);l.useEffect(()=>{if(!t||!r.currentUser){u("/leagues");return}if(P(r.currentUser)){u(`/leagues/${t}`);return}(async()=>{const a=N(),d=f(m(a,"leagueMemberships"),n("leagueId","==",t),n("userId","==",r.currentUser.uid),n("status","==","active"));if(!(await U(d)).empty){u(`/leagues/${t}`);return}})(),g(!0),i(null);const o=N(),h=J(o,"leagues",t),x=C(h,a=>{if(!a.exists()){i("League not found"),g(!1);return}const d={id:a.id,...a.data()};T(d)},a=>{console.error("Error fetching league data:",a),i("Failed to load league data"),g(!1)}),b=f(m(o,"leagueMemberships"),n("leagueId","==",t),n("userId","==",r.currentUser.uid)),L=C(b,a=>{if(!a.empty){const d=a.docs[0].data();if(d.status==="active"){R(!0),y(!1),g(!1),$(3);const p=setInterval(()=>{$(v=>v===null||v<=1?(clearInterval(p),u(`/leagues/${t}`),null):v-1)},1e3);return}else if(d.status==="pending"){R(!1),y(!0),g(!1);return}}R(!1)}),M=f(m(o,"leagueJoinRequests"),n("leagueId","==",t),n("userId","==",r.currentUser.uid),n("status","==","pending")),S=C(M,a=>{y(!a.empty),g(!1)});return()=>{x(),L(),S()}},[t,u]);const O=async c=>{if(c.preventDefault(),!t||!r.currentUser||!s){i("You must be logged in to join a league");return}if(F){u(`/leagues/${t}`);return}if(Y){i("You already have a pending request to join this league");return}if(!s.isPublic&&s.createdBy!==r.currentUser.uid&&!P(r.currentUser)){i("This is a private league. You can only join by invitation.");return}const o=N(),h=await A(J(o,"users",r.currentUser.uid));if(!h.exists()){i("User profile not found");return}const x=h.data(),b=x.username||x.displayName;if(b){const L=f(m(o,"leagueMemberships"),n("leagueId","==",t),n("status","==","active")),M=await U(L);for(const S of M.docs){const a=S.data(),d=await A(J(o,"users",a.userId));if(d.exists()){const p=d.data();if((p.username||p.displayName)===b){i(`A member with username "${b}" is already in this league`);return}}}}w(!0)},G=async()=>{if(!t||!r.currentUser||!s){i("You must be logged in to join a league");return}const c=N(),o=f(m(c,"leagueJoinRequests"),n("leagueId","==",t),n("userId","==",r.currentUser.uid),n("status","==","pending"));if(!(await U(o)).empty){y(!0),i("You already have a pending request to join this league"),w(!1);return}D(!0),i(null),w(!1);try{s.settings.allowJoinRequests?await B(m(c,"leagueJoinRequests"),{leagueId:t,userId:r.currentUser.uid,requestedAt:W(),status:"pending",message:z}):await B(m(c,"leagueMemberships"),{leagueId:t,userId:r.currentUser.uid,joinedAt:W(),status:"active",role:"player",stats:{gamesPlayed:0,gamesWon:0,totalPoints:0,winRate:0,currentStreak:0,longestWinStreak:0}})}catch(x){console.error("Error joining league:",x)}finally{D(!1)}};return E?e.jsx("div",{className:"flex h-full items-center justify-center",children:e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-t-2 border-b-2 border-blue-500"})}):j||!s?e.jsxs("div",{className:"p-6 max-w-6xl mx-auto",children:[e.jsx("div",{className:"bg-red-100 border-l-4 border-red-500 p-4 mb-4",children:e.jsx("div",{className:"flex",children:e.jsx("div",{className:"ml-3",children:e.jsx("p",{className:"text-red-700",children:j||"League not found"})})})}),e.jsx(I,{to:"/leagues",className:"text-blue-600 hover:underline",children:"← Back to Leagues"})]}):e.jsxs("div",{className:"p-6 max-w-6xl mx-auto dark:text-white",children:[e.jsxs("h1",{className:"text-2xl font-bold mb-6 flex items-center",children:[e.jsx(_,{className:"h-7 w-7 mr-2 text-blue-500"}),"Join League: ",s.name]}),e.jsxs("div",{className:"bg-white dark:bg-zinc-800 rounded-lg shadow p-6 mb-6",children:[e.jsx("h2",{className:"text-xl font-semibold mb-4",children:"League Information"}),e.jsx("p",{className:"text-gray-700 dark:text-gray-300 mb-4",children:s.description}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4 mb-4",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-medium mb-2",children:"Details"}),e.jsxs("ul",{className:"space-y-2 text-gray-700 dark:text-gray-300",children:[e.jsxs("li",{className:"flex items-center",children:[e.jsx(K,{className:"h-5 w-5 mr-2 text-gray-500"}),e.jsxs("span",{children:[s.stats?.totalMembers||0," members"]})]}),e.jsxs("li",{className:"flex items-center",children:[e.jsx(ee,{className:"h-5 w-5 mr-2 text-gray-500"}),e.jsxs("span",{children:["Created"," ",s.createdAt?new Date(s.createdAt.toDate()).toLocaleDateString():"Unknown"]})]}),e.jsxs("li",{className:"flex items-center",children:[e.jsx(se,{className:"h-5 w-5 mr-2 text-gray-500"}),e.jsxs("span",{children:[s.settings?.gameMode==="double"?"Team":"Individual"," ","mode • ",s.settings?.pointsToWin||100," points"]})]}),e.jsx("li",{className:"flex items-center",children:s.isPublic?e.jsxs(e.Fragment,{children:[e.jsx("svg",{className:"h-5 w-5 mr-2 text-blue-500",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M3.055 11H5a2 2 0 012 2v1a2 2 0 002 2 2 2 0 012 2v2.945M8 3.935V5.5A2.5 2.5 0 0010.5 8h.5a2 2 0 012 2 2 2 0 104 0 2 2 0 012-2h1.064M15 20.488V18a2 2 0 012-2h3.064M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})}),e.jsx("span",{className:"text-blue-600 dark:text-blue-400",children:"Public League - Anyone can join"})]}):e.jsxs(e.Fragment,{children:[e.jsx("svg",{className:"h-5 w-5 mr-2 text-purple-500",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 15v2m-6 4h12a2 2 0 002-2v-6a2 2 0 00-2-2H6a2 2 0 00-2 2v6a2 2 0 002 2zm10-10V7a4 4 0 00-8 0v4h8z"})}),e.jsx("span",{className:"text-purple-600 dark:text-purple-400",children:"Private League - Invitation only"})]})})]})]}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-medium mb-2",children:"Game Settings"}),e.jsxs("ul",{className:"space-y-2 text-gray-700 dark:text-gray-300",children:[e.jsxs("li",{children:[e.jsx("strong",{children:"Format:"})," ",s.settings?.tournamentFormat?s.settings.tournamentFormat.replace("-"," "):"Standard"]}),e.jsxs("li",{children:[e.jsx("strong",{children:"Rounds:"})," ",s.settings?.numberOfRounds||0]}),e.jsxs("li",{children:[e.jsx("strong",{children:"Points System:"})," ",s.settings?.scoringSystem?.pointsPerWin||0," pts win /"," ",s.settings?.scoringSystem?.pointsPerDraw||0," pts draw"]})]})]})]})]}),e.jsx("div",{className:"bg-white dark:bg-zinc-800 rounded-lg shadow p-6",children:F?e.jsxs("div",{className:"text-center py-8",children:[e.jsxs("div",{className:"mb-4",children:[e.jsx("div",{className:"w-16 h-16 bg-green-100 dark:bg-green-900/30 rounded-full flex items-center justify-center mx-auto mb-4",children:e.jsx("svg",{className:"w-8 h-8 text-green-600 dark:text-green-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M5 13l4 4L19 7"})})}),e.jsx("h2",{className:"text-xl font-semibold mb-2 text-green-700 dark:text-green-300",children:"You are already a member of this league!"}),e.jsx("p",{className:"text-gray-600 dark:text-gray-400 mb-4",children:"You have full access to view league details, participate in games, and compete with other members."}),q!==null&&e.jsx("div",{className:"bg-blue-50 dark:bg-blue-900/20 border border-blue-200 dark:border-blue-800 rounded-md px-4 py-3 mb-4 inline-block",children:e.jsxs("p",{className:"text-blue-700 dark:text-blue-300 text-sm",children:["Redirecting to league page in ",q," second",q!==1?"s":"","..."]})})]}),e.jsxs("div",{className:"flex justify-center space-x-3",children:[e.jsx("button",{onClick:()=>u(`/leagues/${t}`),className:"px-6 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700 transition-colors",children:"Go to League Now"}),e.jsx("button",{onClick:()=>u("/leagues"),className:"px-6 py-2 bg-gray-200 text-gray-800 rounded-md hover:bg-gray-300 dark:bg-zinc-700 dark:text-gray-200 dark:hover:bg-zinc-600 transition-colors",children:"Back to All Leagues"})]})]}):Y?e.jsxs("div",{className:"text-center py-6",children:[e.jsx("h2",{className:"text-xl font-semibold mb-2",children:"Your request to join is pending"}),e.jsx("p",{className:"text-gray-600 dark:text-gray-400 mb-4",children:"Your request has been submitted and is awaiting approval. The league administrator will review your request soon."}),e.jsx("div",{className:"flex justify-center",children:e.jsxs("div",{className:"bg-yellow-50 dark:bg-yellow-900/20 border border-yellow-200 dark:border-yellow-800 rounded-md px-4 py-3 flex items-center",children:[e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5 text-yellow-500 mr-2",viewBox:"0 0 20 20",fill:"currentColor",children:e.jsx("path",{fillRule:"evenodd",d:"M10 18a8 8 0 100-16 8 8 0 000 16zm1-12a1 1 0 10-2 0v4a1 1 0 00.293.707l2.828 2.829a1 1 0 101.415-1.415L11 9.586V6z",clipRule:"evenodd"})}),e.jsx("span",{className:"text-yellow-700 dark:text-yellow-400",children:"Request pending approval"})]})}),e.jsx("div",{className:"mt-4",children:e.jsx(I,{to:`/leagues/${t}`,className:"px-4 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700",children:"View League"})})]}):e.jsxs("form",{onSubmit:O,children:[e.jsx("h2",{className:"text-xl font-semibold mb-4",children:"Join Request"}),j&&e.jsx("div",{className:"bg-red-50 border-l-4 border-red-500 p-4 mb-4 dark:bg-red-900/20",children:e.jsx("p",{className:"text-red-700 dark:text-red-300",children:j})}),s.settings?.allowJoinRequests&&e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{htmlFor:"joinMessage",className:"block text-sm font-medium mb-1",children:"Message (Optional)"}),e.jsx("textarea",{id:"joinMessage",value:z,onChange:c=>Q(c.target.value),placeholder:"Introduce yourself to the league administrators",className:"w-full p-2 border border-gray-300 rounded-md focus:outline-none focus:ring-blue-500 focus:border-blue-500 dark:bg-zinc-700 dark:border-zinc-600",rows:3}),e.jsx("p",{className:"mt-1 text-sm text-gray-500",children:s.settings?.allowJoinRequests?"Your request will need to be approved by a league administrator.":"You will be added to the league immediately."})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx(I,{to:`/leagues/${t}`,className:"px-4 py-2 bg-gray-200 text-gray-800 rounded-md hover:bg-gray-300 dark:bg-zinc-700 dark:text-gray-200 dark:hover:bg-zinc-600",children:"Cancel"}),e.jsx("button",{type:"submit",disabled:k,className:`px-4 py-2 rounded-md font-medium ${k?"bg-gray-300 text-gray-500 cursor-not-allowed dark:bg-zinc-700 dark:text-zinc-400":"bg-green-600 text-white hover:bg-green-700"}`,children:k?"Processing...":s.settings?.allowJoinRequests?"Submit Request to Join":"Join League"})]})]})}),e.jsx(X,{isOpen:V,onClose:()=>w(!1),onConfirm:G,title:"Confirm Join League",message:`Are you sure you want to join "${s?.name}"? ${s?.settings?.allowJoinRequests?"Your request will be sent to the league administrators for approval.":"You will be added to the league immediately."}`,confirmText:s?.settings?.allowJoinRequests?"Send Request":"Join League",confirmButtonClass:"bg-blue-600 hover:bg-blue-700 text-white"})]})};export{ie as default};
