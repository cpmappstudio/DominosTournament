import{j as e,C as S,a as G,b as ne,c as ie,d as z,u as de,e as oe,F as Y,D as ce,f as me,g as xe,h as ue,B as q,i as he,k as ge,l as pe,m as be,T as fe,L as je,S as F,n as Z,o as Ne,p as V,q as C,r as p,s as K,t as m}from"./index-BvCtGHzh.js";import{r as s,d as we}from"./router-DHx2Xk7F.js";import{c as ke,j as ye,h as ve}from"./firebase-DBzIg5Y3.js";import{F as Pe,a as Ce}from"./TrashIcon-CsJ-wBAl.js";import{F as Se}from"./ExclamationCircleIcon-4xKnvw3m.js";import"./vendor-DJG_os-6.js";const P=s.memo(({title:a,description:r,children:n,className:o="",loading:d=!1,skeleton:c})=>d&&c?c:e.jsxs(S,{className:`w-full ${o}`,children:[e.jsxs(G,{children:[e.jsx(ne,{className:"text-lg sm:text-xl",children:a}),r&&e.jsx(ie,{children:r})]}),e.jsx(z,{className:"pt-0",children:n})]}));P.displayName="ProfileCard";function ze({title:a,titleId:r,...n},o){return s.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor","aria-hidden":"true","data-slot":"icon",ref:o,"aria-labelledby":r},n),a?s.createElement("title",{id:r},a):null,s.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M15.75 6a3.75 3.75 0 1 1-7.5 0 3.75 3.75 0 0 1 7.5 0ZM4.501 20.118a7.5 7.5 0 0 1 14.998 0A17.933 17.933 0 0 1 12 21.75c-2.676 0-5.216-.584-7.499-1.632Z"}))}const Re=s.forwardRef(ze),Le=({user:a,onImageUpdate:r,onError:n,className:o="",size:d="lg"})=>{const[c,b]=s.useState(!1),[f,x]=s.useState(null),[I,k]=s.useState(!1),[$,u]=s.useState(!1),h=s.useRef(null),j={sm:{container:"w-16 h-16",icon:"h-4 w-4",button:"p-1",text:"text-xs"},md:{container:"w-20 h-20",icon:"h-5 w-5",button:"p-1.5",text:"text-sm"},lg:{container:"w-24 h-24",icon:"h-6 w-6",button:"p-2",text:"text-base"}}[d],R=o.includes("w-")?"":j.container,L=s.useCallback(t=>{if(!t.type.startsWith("image/"))return"Please select an image file (JPG, PNG, GIF, WebP)";const l=5*1024*1024;return t.size>l?"Image size must be less than 5MB":null},[]),w=s.useCallback(async t=>{const l=L(t);if(l){x(l),n&&n(l);return}b(!0),x(null);try{const g=await de(t,a.uid);r(g),x(null),u(!1)}catch(g){console.error("Upload error:",g);let N="Failed to upload image";g instanceof Error?g.message.includes("storage/unauthorized")||g.message.includes("CORS")?N="Firebase Storage is not enabled. Please check the setup guide.":g.message.includes("storage/quota-exceeded")?N="Storage quota exceeded. Please contact support.":N=g.message:N="Firebase Storage is not properly configured. Please enable Storage in Firebase Console.",x(N),n&&n(N)}finally{b(!1),h.current&&(h.current.value="")}},[a.uid,r,n,L]),M=s.useCallback(t=>{const l=t.target.files?.[0];l&&w(l)},[w]),D=s.useCallback(t=>{t.preventDefault(),k(!0)},[]),U=s.useCallback(t=>{t.preventDefault(),k(!1)},[]),W=s.useCallback(t=>{t.preventDefault(),k(!1);const l=t.dataTransfer.files;l.length>0&&w(l[0])},[w]),E=s.useCallback(async()=>{b(!0),x(null);try{await oe(a.uid),r(null),x(null),u(!1)}catch(t){const l=t instanceof Error?t.message:"Failed to delete image";x(l),n&&n(l)}finally{b(!1)}},[a.uid,r,n]),y=s.useCallback(()=>{h.current?.click()},[]),B=s.useCallback(()=>{a.photoURL?u(!0):y()},[a.photoURL,y]);return e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:`space-y-3 ${o}`,children:[e.jsxs("div",{className:`
            relative ${R} rounded-full overflow-hidden border-2 border-dashed 
            transition-all duration-200 cursor-pointer flex-shrink-0 ${o}
            ${I?"border-blue-500 bg-blue-50 dark:bg-blue-900/20":"border-gray-300 dark:border-zinc-600 hover:border-gray-400 dark:hover:border-zinc-500"}
            ${c?"pointer-events-none opacity-75":""}
            ${f?"border-red-500 bg-red-50 dark:bg-red-900/20":""}
          `,onDragOver:D,onDragLeave:U,onDrop:W,onClick:B,children:[a.photoURL?e.jsx("img",{src:a.photoURL,alt:a.displayName||"Profile",className:"w-full h-full object-cover"}):e.jsxs("div",{className:"flex flex-col items-center justify-center h-full bg-gradient-to-br from-blue-500 to-purple-600 text-white",children:[e.jsx(Re,{className:`${j.icon} mb-1`}),e.jsxs("div",{className:`${j.text} text-center`,children:[e.jsx("p",{className:"font-medium",children:"Photo"}),e.jsx("p",{className:"text-xs opacity-75",children:"Upload"})]})]}),c&&e.jsx("div",{className:"absolute inset-0 bg-black bg-opacity-50 flex items-center justify-center",children:e.jsx("div",{className:"animate-spin rounded-full h-6 w-6 border-t-2 border-b-2 border-white"})})]}),e.jsx("input",{ref:h,type:"file",accept:"image/*",onChange:M,className:"hidden",disabled:c}),f&&e.jsxs("div",{className:"flex items-start gap-2 p-3 bg-red-50 border border-red-200 text-red-700 text-sm rounded-md dark:bg-red-900/20 dark:border-red-800 dark:text-red-300",children:[e.jsx(Y,{className:"h-5 w-5 flex-shrink-0 mt-0.5"}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium",children:"Upload Error"}),e.jsx("p",{className:"text-xs mt-1 opacity-90",children:f})]})]})]}),e.jsxs(ce,{open:$,onClose:()=>u(!1),size:"lg",children:[e.jsx(me,{children:"Profile Picture"}),e.jsxs(xe,{children:[a.photoURL&&e.jsx("div",{className:"mb-6",children:e.jsx("img",{src:a.photoURL,alt:a.displayName||"Profile",className:"w-full h-auto max-h-96 object-contain rounded-lg"})}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"text-sm text-gray-600 dark:text-gray-400 space-y-1",children:[e.jsx("p",{children:"• Supported formats: JPG, PNG, GIF, WebP"}),e.jsx("p",{children:"• Maximum size: 5MB"}),e.jsx("p",{children:"• Drag & drop or click to upload"})]}),f&&e.jsxs("div",{className:"flex items-start gap-2 p-3 bg-red-50 border border-red-200 text-red-700 text-sm rounded-md dark:bg-red-900/20 dark:border-red-800 dark:text-red-300",children:[e.jsx(Y,{className:"h-5 w-5 flex-shrink-0 mt-0.5"}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium",children:"Upload Error"}),e.jsx("p",{className:"text-xs mt-1 opacity-90",children:f})]})]})]})]}),e.jsxs(ue,{children:[e.jsx(q,{outline:!0,onClick:()=>u(!1),disabled:c,children:"Cancel"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(q,{onClick:y,disabled:c,color:"blue",children:[e.jsx(Pe,{className:"h-4 w-4 mr-2"}),a.photoURL?"Change Picture":"Upload Picture"]}),a.photoURL&&e.jsxs(q,{onClick:E,disabled:c,color:"red",children:[e.jsx(Ce,{className:"h-4 w-4 mr-2"}),"Remove Picture"]})]})]})]})]})},Q=s.memo(({user:a})=>a.photoURL?e.jsx("img",{src:a.photoURL,alt:a.displayName||"Profile",className:"w-20 h-20 sm:w-24 sm:h-24 rounded-full object-cover border-2 border-gray-200 dark:border-gray-600"}):e.jsx("div",{className:"w-20 h-20 sm:w-24 sm:h-24 bg-gradient-to-br from-blue-500 to-purple-600 rounded-full flex items-center justify-center text-white text-xl sm:text-2xl font-bold",children:a.displayName?.charAt(0)?.toUpperCase()||"P"}));Q.displayName="ProfileImage";const X=s.memo(({game:a,onGameClick:r})=>{const n=s.useCallback(d=>new Date(d).toLocaleDateString("en-US",{year:"numeric",month:"short",day:"numeric"}),[]),o=s.useCallback(()=>{r(a.id)},[a.id,r]);return e.jsxs(C,{className:"cursor-pointer hover:bg-gray-50 dark:hover:bg-zinc-700/50 transition-colors",onClick:o,children:[e.jsx(m,{className:"whitespace-nowrap text-xs sm:text-sm",children:n(a.date.toString())}),e.jsx(m,{className:"text-xs sm:text-sm",children:e.jsx("div",{className:"truncate max-w-20 sm:max-w-none",title:a.opponentName,children:a.opponentName})}),e.jsx(m,{className:"hidden sm:table-cell whitespace-nowrap text-xs sm:text-sm capitalize",children:a.gameMode}),e.jsx(m,{className:"whitespace-nowrap text-xs sm:text-sm",children:e.jsxs("span",{className:`inline-block px-1.5 sm:px-2 py-0.5 sm:py-1 rounded text-xs font-medium ${a.result==="win"?"bg-green-100 text-green-800 dark:bg-green-900 dark:text-green-100":"bg-red-100 text-red-800 dark:bg-red-900 dark:text-red-100"}`,children:[a.result==="win"?"W":"L",e.jsx("span",{className:"hidden sm:inline",children:a.result==="win"?"on":"ost"})]})}),e.jsxs(m,{className:"whitespace-nowrap text-xs sm:text-sm font-mono",children:[a.score.player," - ",a.score.opponent]})]})});X.displayName="GameRow";const H=s.memo(()=>e.jsx("div",{className:"flex h-screen w-full items-center justify-center",children:e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-t-2 border-b-2 border-blue-500"})}));H.displayName="LoadingSpinner";const ee=s.memo(()=>e.jsx(S,{className:"w-full mb-8",children:e.jsx(z,{className:"pt-6",children:e.jsxs("div",{className:"flex flex-col sm:flex-row items-center sm:items-start gap-4 sm:gap-6",children:[e.jsx("div",{className:"w-20 h-20 sm:w-24 sm:h-24 bg-gray-300 dark:bg-zinc-600 rounded-full animate-pulse"}),e.jsxs("div",{className:"flex-grow min-w-0 text-center sm:text-left w-full sm:w-auto",children:[e.jsx("div",{className:"h-6 bg-gray-300 dark:bg-zinc-600 rounded animate-pulse mb-2"}),e.jsx("div",{className:"h-4 bg-gray-300 dark:bg-zinc-600 rounded animate-pulse mb-2 w-3/4"}),e.jsx("div",{className:"h-4 bg-gray-300 dark:bg-zinc-600 rounded animate-pulse w-1/2"})]})]})})}));ee.displayName="ProfileSkeleton";const se=s.memo(()=>e.jsxs(S,{className:"w-full mb-8",children:[e.jsx(G,{children:e.jsx("div",{className:"h-6 bg-gray-300 dark:bg-zinc-600 rounded animate-pulse w-1/3"})}),e.jsx(z,{className:"pt-0",children:e.jsx("div",{className:"grid grid-cols-2 lg:grid-cols-3 gap-3 sm:gap-4",children:[...Array(3)].map((a,r)=>e.jsxs("div",{className:"p-3 sm:p-4 bg-gray-50 dark:bg-zinc-700 rounded-lg",children:[e.jsx("div",{className:"h-4 bg-gray-300 dark:bg-zinc-600 rounded animate-pulse mb-2"}),e.jsx("div",{className:"h-8 bg-gray-300 dark:bg-zinc-600 rounded animate-pulse"})]},r))})})]}));se.displayName="StatsSkeleton";const ae=s.memo(()=>e.jsxs(S,{className:"w-full",children:[e.jsx(G,{children:e.jsx("div",{className:"h-6 bg-gray-300 dark:bg-zinc-600 rounded animate-pulse w-1/4"})}),e.jsx(z,{className:"pt-0",children:e.jsxs(Z,{children:[e.jsx(V,{children:e.jsxs(C,{children:[e.jsx(p,{className:"w-[100px]",children:e.jsx("div",{className:"h-4 bg-gray-300 dark:bg-zinc-600 rounded animate-pulse"})}),e.jsx(p,{children:e.jsx("div",{className:"h-4 bg-gray-300 dark:bg-zinc-600 rounded animate-pulse"})}),e.jsx(p,{className:"hidden sm:table-cell",children:e.jsx("div",{className:"h-4 bg-gray-300 dark:bg-zinc-600 rounded animate-pulse"})}),e.jsx(p,{children:e.jsx("div",{className:"h-4 bg-gray-300 dark:bg-zinc-600 rounded animate-pulse"})}),e.jsx(p,{children:e.jsx("div",{className:"h-4 bg-gray-300 dark:bg-zinc-600 rounded animate-pulse"})})]})}),e.jsx(K,{children:[...Array(3)].map((a,r)=>e.jsxs(C,{children:[e.jsx(m,{children:e.jsx("div",{className:"h-4 bg-gray-300 dark:bg-zinc-600 rounded animate-pulse w-16"})}),e.jsx(m,{children:e.jsx("div",{className:"h-4 bg-gray-300 dark:bg-zinc-600 rounded animate-pulse w-24"})}),e.jsx(m,{className:"hidden sm:table-cell",children:e.jsx("div",{className:"h-4 bg-gray-300 dark:bg-zinc-600 rounded animate-pulse w-16"})}),e.jsx(m,{children:e.jsx("div",{className:"h-4 bg-gray-300 dark:bg-zinc-600 rounded animate-pulse w-8"})}),e.jsx(m,{children:e.jsx("div",{className:"h-4 bg-gray-300 dark:bg-zinc-600 rounded animate-pulse w-12"})})]},r))})]})})]}));ae.displayName="GamesSkeleton";const De=s.memo(()=>e.jsxs(S,{className:"w-full mb-8",children:[e.jsx(G,{children:e.jsx("div",{className:"h-6 bg-gray-300 dark:bg-zinc-600 rounded animate-pulse w-1/4"})}),e.jsx(z,{className:"pt-0",children:e.jsx("div",{className:"flex gap-4",children:[...Array(2)].map((a,r)=>e.jsx("div",{className:"w-48 h-16 bg-gray-300 dark:bg-zinc-600 rounded animate-pulse"},r))})})]}));H.displayName="LoadingSpinner";const Ue=s.memo(({user:a})=>{const r=we(),[n,o]=s.useState(a||null),[d,c]=s.useState(null),[b,f]=s.useState([]),[x,I]=s.useState([]),[k,$]=s.useState(!0),[u,h]=s.useState({profile:!0,games:!0,leagues:!0}),[T,j]=s.useState(null),R=s.useRef(new Map),L=s.useCallback(t=>{r(`/game/${t}`)},[r]),w=s.useCallback(t=>{o(l=>l&&{...l,photoURL:t}),j(null)},[]),M=s.useCallback(t=>{j(t),setTimeout(()=>{j(null)},5e3)},[]),D=s.useCallback(async t=>{try{h({profile:!0,games:!0,leagues:!0});const[l,g]=await Promise.all([he(t.uid),ge()]);c(l),h(i=>({...i,profile:!1}));const te=g.filter(i=>i.status==="completed").slice(0,5).map(async i=>{const A=i.createdBy===t.uid,O=A?i.opponent:i.createdBy;let v=R.current.get(O);if(!v)try{const _=ke(),J=await ye(ve(_,"users",O));v=J.exists()?J.data().displayName:"Unknown Player",R.current.set(O,v)}catch{v="Unknown Player"}return{id:i.id||"",date:i.updatedAt?.toDate()||new Date,opponentName:v,gameMode:i.settings.gameMode==="single"?"individual":"teams",result:i.winner===t.uid?"win":"loss",score:{player:A?i.scores?.creator||0:i.scores?.opponent||0,opponent:A?i.scores?.opponent||0:i.scores?.creator||0}}}),[le,re]=await Promise.all([Promise.all(te),pe(t.uid)]);f(le),h(i=>({...i,games:!1})),I(re),h(i=>({...i,leagues:!1}))}catch(l){console.error("Error fetching profile data:",l),h({profile:!1,games:!1,leagues:!1})}},[]);s.useEffect(()=>{const t=be.onAuthStateChanged(async l=>{o(l),l&&await D(l),$(!1)});return()=>t()},[D]);const U=s.useMemo(()=>!d?.stats?.gamesPlayed||d.stats.gamesPlayed===0?null:Math.round(d.stats.gamesWon/d.stats.gamesPlayed*100),[d?.stats]),W=!u.profile,E=!u.profile,y=!u.leagues,B=!u.games;return k?e.jsx(H,{}):n?e.jsxs("div",{className:"p-2 sm:p-4 lg:p-6 w-full lg:max-w-6xl lg:mx-auto dark:text-white",children:[e.jsx("h1",{className:"sr-only",children:"Player Profile"}),T&&e.jsx("div",{className:"mb-6 p-4 bg-red-50 border border-red-200 text-red-700 rounded-lg dark:bg-red-900/20 dark:border-red-800 dark:text-red-300",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx(Se,{className:"h-5 w-5 mr-2 flex-shrink-0"}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-medium",children:"Image Upload Error"}),e.jsx("p",{className:"text-sm mt-1",children:T})]})]})}),e.jsx(P,{title:"Player Information",className:"mb-8",loading:!W,skeleton:e.jsx(ee,{}),children:e.jsxs("div",{className:"flex flex-col sm:flex-row items-center sm:items-start gap-4 sm:gap-6",children:[e.jsx("div",{className:"flex-shrink-0",children:n?e.jsx(Le,{user:n,onImageUpdate:w,onError:M,size:"lg",className:"w-20 h-20 sm:w-24 sm:h-24"}):e.jsx(Q,{user:n})}),e.jsxs("div",{className:"flex-grow min-w-0 text-center sm:text-left w-full sm:w-auto",children:[e.jsx("h2",{className:"text-xl sm:text-2xl font-semibold text-zinc-900 dark:text-white break-words",children:n.displayName||"Player"}),d?.username&&e.jsxs("p",{className:"text-sm text-zinc-500 dark:text-zinc-400 break-all mt-1",children:["@",d.username]}),e.jsx("p",{className:"text-sm sm:text-base text-zinc-600 dark:text-zinc-400 mt-1 break-all sm:break-words",children:n.email}),e.jsx("div",{className:"mt-3",children:e.jsx(fe,{gamesWon:d?.stats?.gamesWon||0})})]})]})}),e.jsx(P,{title:"Your Leagues",className:"mb-8",loading:!y,skeleton:e.jsx(De,{}),children:x.length===0?e.jsx("div",{className:"text-sm text-zinc-500 dark:text-zinc-400",children:"You are not a member of any active leagues."}):e.jsx("div",{className:"flex flex-wrap gap-4",children:x.map(t=>e.jsx(je,{league:t,showRanking:!0,href:`/leagues/${t.id}`},t.id))})}),e.jsx(P,{title:"Player Statistics",className:"mb-8",loading:!E,skeleton:e.jsx(se,{}),children:e.jsxs("div",{className:"grid grid-cols-2 lg:grid-cols-3 gap-3 sm:gap-4",children:[e.jsx(F,{title:"Games Played",value:d?.stats?.gamesPlayed||0,color:"text-zinc-900 dark:text-white"}),e.jsx(F,{title:"Games Won",value:d?.stats?.gamesWon||0,color:"text-green-600 dark:text-green-400"}),e.jsx(F,{title:"Total Points",value:d?.stats?.totalPoints||0,color:"text-blue-600 dark:text-blue-400",className:"col-span-2 lg:col-span-1"}),U!==null&&e.jsx(F,{title:"Win Rate",value:`${U}%`,color:"text-purple-600 dark:text-purple-400",className:"col-span-2 lg:col-span-3"})]})}),e.jsxs(P,{title:"Last 5 Matches",loading:!B,skeleton:e.jsx(ae,{}),children:[e.jsx("div",{className:"overflow-x-auto",children:e.jsxs(Z,{children:[b.length===0&&e.jsx(Ne,{children:"No completed games yet"}),e.jsx(V,{children:e.jsxs(C,{children:[e.jsx(p,{className:"w-[100px]",children:"Date"}),e.jsx(p,{children:"Opponent"}),e.jsx(p,{className:"hidden sm:table-cell",children:"Type"}),e.jsx(p,{children:"Result"}),e.jsx(p,{children:"Score"})]})}),e.jsx(K,{children:b.length>0?b.map(t=>e.jsx(X,{game:t,onGameClick:L},t.id)):e.jsx(C,{children:e.jsx(m,{colSpan:5,className:"h-24 text-center text-muted-foreground",children:"No completed games yet"})})})]})}),b.length>0&&e.jsx("div",{className:"mt-4 text-center",children:e.jsx("button",{onClick:()=>r("/games"),className:"px-4 py-2 text-sm font-medium text-blue-600 hover:text-blue-800 dark:text-blue-400 dark:hover:text-blue-200 hover:bg-blue-50 dark:hover:bg-blue-900/20 rounded-lg transition-colors",children:"View All Games"})})]})]}):e.jsxs("div",{className:"p-4 sm:p-6 lg:max-w-6xl lg:mx-auto text-center w-full",children:[e.jsx("h1",{className:"text-3xl font-bold mb-6",children:"Player Profile"}),e.jsx("div",{className:"bg-white dark:bg-zinc-800 rounded-lg shadow p-6",children:e.jsx("p",{className:"text-lg",children:"Please sign in to view your profile."})})]})});Ue.displayName="Profile";export{Ue as default};
