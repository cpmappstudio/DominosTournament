import{v as Ne,m as o,w as ve,i as O,x as ee,y as ke,z as we,A as Pe,E as Ce,G as Se,j as e,C as E,d as Y,H as se,U as Ue,I as Re,J as Ie,K as ze}from"./index-BSbyIc-9.js";import{r as l,g as Ge,d as Te,L as _}from"./router-DHx2Xk7F.js";import{c as Ae,h as Le,m as We}from"./firebase-DBzIg5Y3.js";import"./vendor-DJG_os-6.js";const te=l.memo(({gameMode:d})=>{const i=Re(d);return e.jsxs("div",{className:"p-3 bg-gray-50 dark:bg-zinc-700 rounded-md",children:[e.jsx("p",{className:"text-sm text-gray-500 dark:text-zinc-400",children:"Game Mode"}),e.jsxs("p",{className:"font-medium",children:[i?.label||d,!i?.isValid&&e.jsx("span",{className:"ml-2 text-xs text-red-500",children:"(Legacy)"})]}),i?.description&&e.jsx("p",{className:"text-xs text-gray-400 dark:text-zinc-500 mt-1",children:i.description})]})}),ae=l.memo(({points:d})=>{const i=Ie(d);return e.jsxs("div",{className:"p-3 bg-gray-50 dark:bg-zinc-700 rounded-md",children:[e.jsx("p",{className:"text-sm text-gray-500 dark:text-zinc-400",children:"Points to Win"}),e.jsxs("p",{className:"font-medium",children:[i?.label||`${d} points`,!i?.isValid&&e.jsx("span",{className:"ml-2 text-xs text-red-500",children:"(Custom)"})]}),i?.description&&e.jsx("p",{className:"text-xs text-gray-400 dark:text-zinc-500 mt-1",children:i.description})]})}),re=l.memo(({useBoricuaRules:d})=>{const P=ze(d?"boricua":"standard");return e.jsxs("div",{className:"p-3 bg-gray-50 dark:bg-zinc-700 rounded-md",children:[e.jsx("p",{className:"text-sm text-gray-500 dark:text-zinc-400",children:"Game Rules"}),e.jsxs("p",{className:"font-medium",children:[P?.label||(d?"Boricua":"Standard"),!P?.isValid&&e.jsx("span",{className:"ml-2 text-xs text-red-500",children:"(Legacy)"})]}),P?.description&&e.jsx("p",{className:"text-xs text-gray-400 dark:text-zinc-500 mt-1",children:P.description})]})});te.displayName="GameModeDisplay";ae.displayName="PointsDisplay";re.displayName="RulesetDisplay";const De=({refreshNotifications:d})=>{const{id:i}=Ge(),P=Te(),[ne,n]=l.useState({game:null,creator:null,opponent:null,team1Players:[],team2Players:[],leagueInfo:null,loading:!0,error:null}),[le,p]=l.useState({creatorScore:0,opponentScore:0,isSubmitting:!1}),[ie,oe]=l.useState({rejectionReason:""}),{isOpen:de,selectedUser:j,openModal:V,closeModal:ce}=Ne(),{game:s,creator:b,opponent:u,team1Players:h,team2Players:N,leagueInfo:S,loading:me,error:M}=ne,{creatorScore:v,opponentScore:k,isSubmitting:m}=le,{rejectionReason:$}=ie,B=l.useCallback(()=>s?.activePlayer?s.teams?[...h,...N].find(r=>r.uid===s.activePlayer)?.displayName||"Unknown":s.activePlayer===s.createdBy?b?.displayName||"Creator":u?.displayName||"Opponent":"Unknown",[s,b,u,h,N]),ue=l.useCallback(()=>s?.teams?(h.some(r=>r.uid===o.currentUser?.uid)?N:h).map(r=>r.displayName).join(" and "):u?.displayName||"the opponent",[s,u,h,N]),U=l.useCallback(()=>{if(s?.teams){const t=h.map(r=>r.displayName).join(" + "),a=N.map(r=>r.displayName).join(" + ");return{team1:t,team2:a}}else return{team1:b?.displayName||"Creator",team2:u?.displayName||"Opponent"}},[s,b,u,h,N]),I=l.useCallback(()=>!s||!o.currentUser?!1:s.createdBy===o.currentUser.uid||s.opponent===o.currentUser.uid?!0:s.teams?[...s.teams.team1||[],...s.teams.team2||[]].includes(o.currentUser.uid):!1,[s]),z=l.useCallback(()=>!s||!o.currentUser?!1:s.createdBy===o.currentUser.uid?!0:s.teams&&s.teams.team1&&s.teams.team1.length>0?s.teams.team1[0]===o.currentUser.uid:!1,[s]),q=l.useCallback(()=>!s||!o.currentUser?!1:s.opponent===o.currentUser.uid?!0:s.teams&&s.teams.team2&&s.teams.team2.length>0?s.teams.team2[0]===o.currentUser.uid:!1,[s]),G=l.useCallback(()=>{if(!s||!o.currentUser)return!1;const t=o.currentUser.uid;if(s.teams){const a=s.teams.team1&&s.teams.team1[0]===t,r=s.teams.team2&&s.teams.team2[0]===t;return!a&&!r?!1:s.status==="in_progress"&&s.activePlayer?s.activePlayer===t:!0}return s.status==="in_progress"&&s.activePlayer?s.activePlayer===t:z()},[s,z]),R=l.useCallback(()=>{if(!s||!o.currentUser)return!1;if(s.teams&&s.playerResponses){const t=s.playerResponses.find(a=>a.userId===o.currentUser.uid);return s.status==="invited"&&t&&t.response==="pending"}return s.status==="invited"&&s.opponent===o.currentUser.uid},[s]),H=l.useCallback(()=>!s||!o.currentUser?!1:s.status==="invited"&&s.createdBy===o.currentUser.uid,[s]),T=l.useCallback(()=>s?s.teams&&s.playerResponses?s.status==="accepted"&&s.allPlayersAccepted===!0:s.status==="accepted":!1,[s]),J=l.useCallback(()=>{if(!s||!o.currentUser||!s.teams||!s.playerResponses||s.status!=="invited")return!1;const t=s.playerResponses.find(x=>x.userId===o.currentUser.uid),a=t&&t.response==="accepted",r=s.playerResponses.some(x=>x.response==="pending"),c=s.createdBy===o.currentUser.uid;return(a||c)&&r},[s]),K=l.useCallback(()=>!s||!o.currentUser||!s.activePlayer?!1:s.activePlayer===o.currentUser.uid,[s]),A=l.useCallback(()=>!s||!o.currentUser?!1:s.status==="waiting_confirmation"&&s.confirmedBy===o.currentUser.uid,[s]),Q=l.useCallback(async t=>{try{n(c=>({...c,loading:!0,error:null}));const a=await ve(t);if(!a){n(c=>({...c,loading:!1,error:"Game not found"}));return}if(a.teams&&a.teams.team1&&a.teams.team2){const x=[...a.teams.team1,...a.teams.team2].map(f=>O(f)),y=a.leagueId?ee(a.leagueId):Promise.resolve(null),[w,W]=await Promise.allSettled([Promise.allSettled(x),y]),C=w.status==="fulfilled"?w.value.map(f=>f.status==="fulfilled"?f.value:null).filter(f=>f!==null):[],F=C.filter(f=>a.teams.team1.includes(f.uid)),je=C.filter(f=>a.teams.team2.includes(f.uid)),D=W.status==="fulfilled"?W.value:null,ye=D?{id:D.id,name:D.name,photoURL:D.photoURL}:null;n({game:a,creator:null,opponent:null,team1Players:F,team2Players:je,leagueInfo:ye,loading:!1,error:null})}else{const[c,x,y]=await Promise.allSettled([O(a.createdBy),O(a.opponent),a.leagueId?ee(a.leagueId):Promise.resolve(null)]),w=c.status==="fulfilled"?c.value:null,W=x.status==="fulfilled"?x.value:null,C=y.status==="fulfilled"?y.value:null,F=C?{id:C.id,name:C.name,photoURL:C.photoURL}:null;n({game:a,creator:w,opponent:W,team1Players:[],team2Players:[],leagueInfo:F,loading:!1,error:null})}a.scores&&p(c=>({...c,creatorScore:a.scores?.creator||0,opponentScore:a.scores?.opponent||0}))}catch(a){console.error("Error loading game:",a),n(r=>({...r,loading:!1,error:"Failed to load game details"}))}},[]);l.useEffect(()=>{if(!i){n(x=>({...x,loading:!1,error:"Game ID is missing"}));return}Q(i);const t=Ae(),a=Le(t,"games",i);let r;const c=We(a,x=>{if(x.exists()){const y={id:x.id,...x.data()};clearTimeout(r),r=setTimeout(()=>{n(w=>({...w,game:y})),y.scores&&p(w=>({...w,creatorScore:y.scores.creator,opponentScore:y.scores.opponent}))},100)}},x=>{console.error("Error listening to game updates:",x)});return()=>{c(),clearTimeout(r)}},[i,Q]);const xe=l.useCallback(async()=>{if(!i||!R()){n(t=>({...t,error:"You cannot accept this invitation"}));return}try{p(a=>({...a,isSubmitting:!0})),n(a=>({...a,error:null}));const t=await ke(i);t?(n(a=>({...a,game:t})),d&&d()):n(a=>({...a,error:"Failed to accept invitation"}))}catch(t){console.error("Error accepting invitation:",t),n(a=>({...a,error:t.message||"An error occurred while accepting the invitation"}))}finally{p(t=>({...t,isSubmitting:!1}))}},[i,R,d]),be=l.useCallback(async()=>{if(!i||!R()){n(t=>({...t,error:"You cannot reject this invitation"}));return}try{p(a=>({...a,isSubmitting:!0})),n(a=>({...a,error:null}));const t=await we(i,$);t?(n(a=>({...a,game:t})),d&&d(),P("/games")):n(a=>({...a,error:"Failed to reject invitation"}))}catch(t){console.error("Error rejecting invitation:",t),n(a=>({...a,error:t.message||"An error occurred while rejecting the invitation"}))}finally{p(t=>({...t,isSubmitting:!1}))}},[i,R,$,d,P]),pe=l.useCallback(async()=>{if(!i||!T()){n(t=>({...t,error:"This game is not ready to start"}));return}try{p(a=>({...a,isSubmitting:!0})),n(a=>({...a,error:null}));const t=await Pe(i);t?(n(a=>({...a,game:t})),d&&d()):n(a=>({...a,error:"Failed to start the game"}))}catch(t){console.error("Error starting game:",t),n(a=>({...a,error:t.message||"An error occurred while starting the game"}))}finally{p(t=>({...t,isSubmitting:!1}))}},[i,T,d]),ge=l.useCallback(async t=>{if(t.preventDefault(),!i||!I()||!s){n(r=>({...r,error:"You cannot submit scores for this game"}));return}if(!G()){n(r=>({...r,error:"It's not your turn to submit scores"}));return}if(v<0||k<0){n(r=>({...r,error:"Scores cannot be negative"}));return}if(Math.max(v,k)<s.settings.pointsToWin){n(r=>({...r,error:`At least one player must reach ${s.settings.pointsToWin} points to end the game`}));return}try{p(c=>({...c,isSubmitting:!0})),n(c=>({...c,error:null}));const r=await Ce(i,v,k);r?(n(c=>({...c,game:r})),d&&d()):n(c=>({...c,error:"Failed to submit scores"}))}catch(r){console.error("Error submitting scores:",r),n(c=>({...c,error:r.message||"An error occurred while submitting scores"}))}finally{p(r=>({...r,isSubmitting:!1}))}},[i,I,s,G,v,k,d]),X=l.useCallback(async t=>{if(!i||!A()||!s){n(a=>({...a,error:"You cannot confirm this game"}));return}try{p(r=>({...r,isSubmitting:!0})),n(r=>({...r,error:null}));const a=await Se(i,t);a?(n(r=>({...r,game:a})),d&&d()):n(r=>({...r,error:t?"Failed to confirm game":"Failed to dispute game"}))}catch(a){console.error("Error confirming game:",a),n(r=>({...r,error:a.message||"An error occurred while confirming the game"}))}finally{p(a=>({...a,isSubmitting:!1}))}},[i,A,s,d]),g=l.useMemo(()=>s?{isParticipant:I(),isCreator:z(),isOpponent:q(),canSubmitScores:G(),isPendingInvitation:R(),isSentInvitation:H(),isAccepted:T(),isCurrentUserTurn:K(),needsConfirmation:A(),isWaitingForOthers:J()}:null,[s,I,z,q,G,R,H,T,K,A,J]),Z=l.useMemo(()=>{if(!s)return{isValid:!1,canSubmit:!1};const t=Math.max(v,k),a=v>=0&&k>=0,r=a&&t>=s.settings.pointsToWin;return{isValid:a,canSubmit:r,maxScore:t}},[s,v,k]),L=l.useCallback(t=>{V(t)},[V]),he=l.useMemo(()=>e.jsxs("div",{className:"p-4 sm:p-6 max-w-sm sm:max-w-6xl mx-auto text-zinc-900 dark:text-white",children:[e.jsx("h1",{className:"text-xl sm:text-2xl font-bold mb-6",children:"Game Details"}),e.jsx(E,{children:e.jsx(Y,{className:"flex justify-center p-6",children:e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-t-2 border-b-2 border-blue-500"})})})]}),[]),fe=l.useMemo(()=>e.jsxs("div",{className:"p-4 sm:p-6 max-w-sm sm:max-w-6xl mx-auto text-zinc-900 dark:text-white",children:[e.jsx("h1",{className:"text-xl sm:text-2xl font-bold mb-6",children:"Game Details"}),e.jsx(E,{children:e.jsxs(Y,{className:"p-6",children:[e.jsx("div",{className:"p-4 bg-red-100 border border-red-400 text-red-700 rounded mb-4",children:M||"Game not found"}),e.jsx(_,{to:"/games",className:"inline-block px-4 py-2 bg-blue-600 text-white rounded-md",children:"Back to Games"})]})})]}),[M]);return me?he:M||!s?fe:e.jsxs("div",{className:"p-4 sm:p-6 max-w-sm sm:max-w-6xl mx-auto text-zinc-900 dark:text-white",children:[e.jsxs("div",{className:"flex justify-between items-center mb-6",children:[e.jsx("h1",{className:"text-xl sm:text-2xl font-bold",children:"Game Details"}),e.jsx(_,{to:"/games",className:"text-blue-600 hover:text-blue-800 dark:text-blue-400 dark:hover:text-blue-300 text-sm sm:text-base",children:"Back to Games"})]}),e.jsx(E,{children:e.jsxs(Y,{className:"p-4 sm:p-6",children:[e.jsxs("div",{className:"mb-4 sm:mb-6",children:[e.jsxs("span",{className:`inline-block px-2 sm:px-3 py-1 rounded-full text-xs sm:text-sm font-medium 
            ${s.status==="invited"?"bg-amber-100 text-amber-800 dark:bg-amber-900 dark:text-amber-100":""}
            ${s.status==="accepted"?"bg-green-100 text-green-800 dark:bg-green-900 dark:text-green-100":""}
            ${s.status==="rejected"?"bg-red-100 text-red-800 dark:bg-red-900 dark:text-red-100":""}
            ${s.status==="in_progress"?"bg-blue-100 text-blue-800 dark:bg-blue-900 dark:text-blue-100":""}
            ${s.status==="waiting_confirmation"?"bg-purple-100 text-purple-800 dark:bg-purple-900 dark:text-purple-100":""}
            ${s.status==="completed"?"bg-gray-100 text-gray-800 dark:bg-gray-700 dark:text-gray-100":""}
          `,children:[s.status==="invited"&&"Invitation Pending",s.status==="accepted"&&"Ready to Play",s.status==="rejected"&&"Invitation Rejected",s.status==="in_progress"&&"In Progress",s.status==="waiting_confirmation"&&"Waiting for Confirmation",s.status==="completed"&&"Completed"]}),s.status==="in_progress"&&s.activePlayer&&e.jsxs("span",{className:"ml-2 sm:ml-3 text-xs sm:text-sm block sm:inline mt-2 sm:mt-0",children:["Current Turn: ",B()]})]}),e.jsxs("div",{className:"mb-6 space-y-4",children:[e.jsx(te,{gameMode:s.settings.gameMode}),e.jsx(ae,{points:s.settings.pointsToWin}),e.jsx(re,{useBoricuaRules:s.settings.useBoricuaRules||!1}),e.jsxs("div",{className:"p-3 bg-gray-50 dark:bg-zinc-700 rounded-md",children:[e.jsx("p",{className:"text-sm text-gray-500 dark:text-zinc-400",children:"Created"}),e.jsx("p",{className:"font-medium",children:s.createdAt?new Date(s.createdAt.toDate()).toLocaleString():"Unknown"})]}),S&&e.jsx("div",{className:"p-3 bg-blue-50 dark:bg-blue-900/20 border border-blue-200 dark:border-blue-900 rounded-md",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx(se,{src:S.photoURL||void 0,initials:S.name.substring(0,2).toUpperCase(),alt:`${S.name} league`,className:"h-12 w-12 mr-3 flex-shrink-0"}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("p",{className:"text-sm text-blue-600 dark:text-blue-400",children:"League Game"}),e.jsx("p",{className:"font-medium text-blue-800 dark:text-blue-200 truncate",children:S.name}),e.jsx(_,{to:`/leagues/${S.id}`,className:"text-xs text-blue-500 hover:text-blue-700 dark:text-blue-400 dark:hover:text-blue-300",children:"View League Details →"})]})]})})]}),e.jsxs("div",{className:"mb-4 sm:mb-6",children:[e.jsx("h2",{className:"text-base sm:text-lg font-semibold mb-3",children:s.teams?"Teams (2 vs 2)":"Participants"}),s.teams?e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"border border-blue-200 dark:border-blue-800 rounded-lg p-4 bg-blue-50 dark:bg-blue-900/10",children:[e.jsxs("div",{className:"flex items-center mb-3",children:[e.jsx("div",{className:"w-3 h-3 bg-blue-500 rounded-full mr-2"}),e.jsx("h3",{className:"font-medium text-blue-700 dark:text-blue-300",children:"Team 1"})]}),e.jsx("div",{className:"space-y-3",children:h.map((t,a)=>e.jsxs("div",{className:"flex items-center p-2 rounded-md hover:bg-blue-100 dark:hover:bg-blue-800/20 transition-colors cursor-pointer",onClick:()=>L(t),children:[t.photoURL?e.jsx("img",{src:t.photoURL,alt:t.displayName,className:"w-8 h-8 rounded-full mr-2"}):e.jsx("div",{className:"w-8 h-8 rounded-full bg-blue-500 text-white flex items-center justify-center mr-2 text-sm",children:t.displayName.charAt(0).toUpperCase()}),e.jsxs("div",{className:"flex-1",children:[e.jsx("p",{className:"font-medium text-sm",children:t.displayName}),a===0&&e.jsx("p",{className:"text-xs text-blue-600 dark:text-blue-400",children:"Team Captain"}),t.stats&&e.jsxs("div",{className:"flex space-x-2 mt-1",children:[e.jsxs("span",{className:"text-xs text-green-600 dark:text-green-400",children:[t.stats.gamesWon,"W"]}),e.jsxs("span",{className:"text-xs text-blue-600 dark:text-blue-400",children:[t.stats.gamesPlayed,"GP"]})]})]})]},t.uid))})]}),e.jsxs("div",{className:"border border-red-200 dark:border-red-800 rounded-lg p-4 bg-red-50 dark:bg-red-900/10",children:[e.jsxs("div",{className:"flex items-center mb-3",children:[e.jsx("div",{className:"w-3 h-3 bg-red-500 rounded-full mr-2"}),e.jsx("h3",{className:"font-medium text-red-700 dark:text-red-300",children:"Team 2"})]}),e.jsx("div",{className:"space-y-3",children:N.map((t,a)=>e.jsxs("div",{className:"flex items-center p-2 rounded-md hover:bg-red-100 dark:hover:bg-red-800/20 transition-colors cursor-pointer",onClick:()=>L(t),children:[t.photoURL?e.jsx("img",{src:t.photoURL,alt:t.displayName,className:"w-8 h-8 rounded-full mr-2"}):e.jsx("div",{className:"w-8 h-8 rounded-full bg-red-500 text-white flex items-center justify-center mr-2 text-sm",children:t.displayName.charAt(0).toUpperCase()}),e.jsxs("div",{className:"flex-1",children:[e.jsx("p",{className:"font-medium text-sm",children:t.displayName}),a===0&&e.jsx("p",{className:"text-xs text-red-600 dark:text-red-400",children:"Team Captain"}),t.stats&&e.jsxs("div",{className:"flex space-x-2 mt-1",children:[e.jsxs("span",{className:"text-xs text-green-600 dark:text-green-400",children:[t.stats.gamesWon,"W"]}),e.jsxs("span",{className:"text-xs text-blue-600 dark:text-blue-400",children:[t.stats.gamesPlayed,"GP"]})]})]})]},t.uid))})]})]}):e.jsxs("div",{className:"flex flex-col sm:flex-row gap-4",children:[e.jsx("div",{className:"flex-1 p-3 border border-gray-200 dark:border-zinc-700 rounded-md hover:bg-gray-50 dark:hover:bg-zinc-800 transition-colors cursor-pointer",onClick:()=>b&&L(b),children:e.jsxs("div",{className:"flex items-center",children:[b?.photoURL?e.jsx("img",{src:b.photoURL,alt:b.displayName,className:"w-12 h-12 rounded-full mr-3"}):e.jsx("div",{className:"w-12 h-12 rounded-full bg-blue-500 text-white flex items-center justify-center mr-3",children:b?.displayName.charAt(0).toUpperCase()||"?"}),e.jsxs("div",{className:"flex-1",children:[e.jsx("p",{className:"font-medium",children:b?.displayName||"Unknown"}),e.jsx("p",{className:"text-sm text-gray-500 dark:text-zinc-400",children:"Creator"}),b?.stats&&e.jsxs("div",{className:"flex space-x-4 mt-1",children:[e.jsxs("span",{className:"text-xs text-green-600 dark:text-green-400",children:[b.stats.gamesWon," wins"]}),e.jsxs("span",{className:"text-xs text-blue-600 dark:text-blue-400",children:[b.stats.gamesPlayed," games"]})]})]})]})}),e.jsx("div",{className:"flex-1 p-3 border border-gray-200 dark:border-zinc-700 rounded-md hover:bg-gray-50 dark:hover:bg-zinc-800 transition-colors cursor-pointer",onClick:()=>u&&L(u),children:e.jsxs("div",{className:"flex items-center",children:[u?.photoURL?e.jsx("img",{src:u.photoURL,alt:u.displayName,className:"w-12 h-12 rounded-full mr-3"}):e.jsx("div",{className:"w-12 h-12 rounded-full bg-blue-500 text-white flex items-center justify-center mr-3",children:u?.displayName.charAt(0).toUpperCase()||"?"}),e.jsxs("div",{className:"flex-1",children:[e.jsx("p",{className:"font-medium",children:u?.displayName||"Unknown"}),e.jsx("p",{className:"text-sm text-gray-500 dark:text-zinc-400",children:"Opponent"}),u?.stats&&e.jsxs("div",{className:"flex space-x-4 mt-1",children:[e.jsxs("span",{className:"text-xs text-green-600 dark:text-green-400",children:[u.stats.gamesWon," wins"]}),e.jsxs("span",{className:"text-xs text-blue-600 dark:text-blue-400",children:[u.stats.gamesPlayed," games"]})]})]})]})})]})]}),g?.isPendingInvitation&&e.jsxs("div",{className:"mb-6",children:[e.jsx("h2",{className:"text-lg font-semibold mb-3",children:"Game Invitation"}),e.jsxs("div",{className:"p-4 bg-amber-50 dark:bg-amber-900/20 border border-amber-200 dark:border-amber-900 rounded-md mb-4",children:[e.jsx("p",{className:"mb-3",children:s.teams?`${h[0]?.displayName||"A player"} has invited you to play a team game of dominoes (2 vs 2).`:`${b?.displayName||"A player"} has invited you to play a game of dominoes.`}),e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{className:"block text-sm font-medium mb-1",children:"Rejection Reason (optional)"}),e.jsx("input",{type:"text",value:$,onChange:t=>oe(a=>({...a,rejectionReason:t.target.value})),placeholder:"Reason for declining (optional)",className:"w-full p-2 border border-gray-300 rounded-md focus:outline-none focus:ring-blue-500 focus:border-blue-500 dark:bg-zinc-700 dark:border-zinc-600"})]}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-3 sm:gap-4",children:[e.jsx("button",{onClick:be,disabled:m,className:`py-2 rounded-md font-medium ${m?"bg-gray-300 text-gray-500 cursor-not-allowed dark:bg-zinc-700 dark:text-zinc-400":"bg-red-600 text-white hover:bg-red-700"}`,children:m?"Processing...":"Decline Invitation"}),e.jsx("button",{onClick:xe,disabled:m,className:`py-2 rounded-md font-medium ${m?"bg-gray-300 text-gray-500 cursor-not-allowed dark:bg-zinc-700 dark:text-zinc-400":"bg-green-600 text-white hover:bg-green-700"}`,children:m?"Processing...":"Accept Invitation"})]})]})]}),g?.isSentInvitation&&!g?.isWaitingForOthers&&e.jsxs("div",{className:"mb-6",children:[e.jsx("h2",{className:"text-lg font-semibold mb-3",children:"Invitation Sent"}),e.jsx("div",{className:"p-4 bg-blue-50 dark:bg-blue-900/20 border border-blue-200 dark:border-blue-900 rounded-md mb-4",children:e.jsxs("p",{children:["Your invitation has been sent to ",ue(),". You'll be notified when they accept or decline."]})})]}),g?.isWaitingForOthers&&e.jsxs("div",{className:"mb-6",children:[e.jsx("h2",{className:"text-lg font-semibold mb-3",children:s.createdBy===o.currentUser?.uid?"Waiting for Players":"Waiting for Other Players"}),e.jsxs("div",{className:"p-4 bg-yellow-50 dark:bg-yellow-900/20 border border-yellow-200 dark:border-yellow-900 rounded-md mb-4",children:[s.createdBy===o.currentUser?.uid?e.jsx("p",{className:"mb-3",children:"Your team game invitation has been sent. Waiting for all players to accept:"}):e.jsx("p",{className:"mb-3",children:"You've accepted the invitation! Waiting for other players to respond:"}),s.playerResponses&&e.jsx("div",{className:"space-y-2 mt-4",children:s.playerResponses.map(t=>{const a=[...h||[],...N||[]].find(r=>r.uid===t.userId);return e.jsxs("div",{className:"flex items-center justify-between bg-white dark:bg-zinc-800 rounded-md px-3 py-2",children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx(se,{src:a?.photoURL,alt:a?.displayName||"Player",className:"h-8 w-8"}),e.jsx("span",{className:"font-medium",children:a?.displayName||"Unknown Player"})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[t.response==="accepted"&&e.jsxs("span",{className:"text-green-600 dark:text-green-400 font-medium flex items-center",children:[e.jsx("svg",{className:"w-4 h-4 mr-1",fill:"currentColor",viewBox:"0 0 20 20",children:e.jsx("path",{fillRule:"evenodd",d:"M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z",clipRule:"evenodd"})}),"Accepted"]}),t.response==="pending"&&e.jsxs("span",{className:"text-yellow-600 dark:text-yellow-400 font-medium flex items-center",children:[e.jsxs("svg",{className:"w-4 h-4 mr-1 animate-spin",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:[e.jsx("circle",{cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4",className:"opacity-25"}),e.jsx("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]}),"Pending"]}),t.response==="declined"&&e.jsxs("span",{className:"text-red-600 dark:text-red-400 font-medium flex items-center",children:[e.jsx("svg",{className:"w-4 h-4 mr-1",fill:"currentColor",viewBox:"0 0 20 20",children:e.jsx("path",{fillRule:"evenodd",d:"M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z",clipRule:"evenodd"})}),"Declined"]})]})]},t.userId)})})]})]}),g?.isAccepted&&e.jsxs("div",{className:"mb-6",children:[e.jsx("h2",{className:"text-lg font-semibold mb-3",children:"Ready to Play"}),e.jsxs("div",{className:"p-4 bg-green-50 dark:bg-green-900/20 border border-green-200 dark:border-green-900 rounded-md mb-4",children:[e.jsx("p",{className:"mb-3",children:s.teams?"All players have accepted! You're ready to start the team game.":"Both players have accepted! You're ready to start the game."}),e.jsx("button",{onClick:pe,disabled:m,className:`w-full py-2 rounded-md font-medium ${m?"bg-gray-300 text-gray-500 cursor-not-allowed dark:bg-zinc-700 dark:text-zinc-400":"bg-blue-600 text-white hover:bg-blue-700"}`,children:m?"Starting Game...":"Start Game"})]})]}),s.status==="rejected"&&e.jsxs("div",{className:"mb-6",children:[e.jsx("h2",{className:"text-lg font-semibold mb-3",children:"Invitation Declined"}),e.jsxs("div",{className:"p-4 bg-red-50 dark:bg-red-900/20 border border-red-200 dark:border-red-900 rounded-md mb-4",children:[e.jsx("p",{children:"This game invitation was declined."}),s.rejectionReason&&e.jsxs("p",{className:"mt-2",children:[e.jsx("strong",{children:"Reason:"})," ",s.rejectionReason]})]})]}),s.status==="in_progress"&&g?.isParticipant&&e.jsxs("div",{className:"mb-6",children:[e.jsx("h2",{className:"text-lg font-semibold mb-3",children:"Submit Final Scores"}),g?.canSubmitScores?e.jsxs("form",{onSubmit:ge,children:[e.jsxs("div",{className:"p-4 bg-blue-50 dark:bg-blue-900/20 border border-blue-200 dark:border-blue-900 rounded-md mb-4",children:[e.jsx("p",{children:"You are submitting the final scores for this game. The other player will need to confirm these scores."}),e.jsxs("p",{className:"mt-2 text-sm",children:["Enter scores for both players. At least one player must reach ",s.settings.pointsToWin," points."]})]}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-3 sm:gap-4 mb-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-1",children:U().team1}),e.jsx("input",{type:"number",min:"0",max:"999",value:v,onChange:t=>p(a=>({...a,creatorScore:parseInt(t.target.value)||0})),className:"w-full p-2 border border-gray-300 rounded-md focus:outline-none focus:ring-blue-500 focus:border-blue-500 dark:bg-zinc-700 dark:border-zinc-600",required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-1",children:U().team2}),e.jsx("input",{type:"number",min:"0",max:"999",value:k,onChange:t=>p(a=>({...a,opponentScore:parseInt(t.target.value)||0})),className:"w-full p-2 border border-gray-300 rounded-md focus:outline-none focus:ring-blue-500 focus:border-blue-500 dark:bg-zinc-700 dark:border-zinc-600",required:!0})]})]}),e.jsx("button",{type:"submit",disabled:m||!Z.canSubmit,className:`w-full py-2 rounded-md font-medium ${m||!Z.canSubmit?"bg-gray-300 text-gray-500 cursor-not-allowed dark:bg-zinc-700 dark:text-zinc-400":"bg-blue-600 text-white hover:bg-blue-700"}`,children:m?"Submitting...":"Submit Final Scores"})]}):e.jsxs("div",{className:"p-4 bg-yellow-50 dark:bg-yellow-900/20 border border-yellow-200 dark:border-yellow-900 rounded-md mb-4",children:[e.jsx("p",{children:"It's not your turn to submit scores. Wait for the active player to finish their turn."}),e.jsxs("p",{className:"mt-2 text-sm",children:["Active player: ",e.jsx("span",{className:"font-medium",children:B()})]})]})]}),g?.needsConfirmation&&e.jsxs("div",{className:"mb-6",children:[e.jsx("h2",{className:"text-lg font-semibold mb-3",children:"Confirm Results"}),e.jsxs("div",{className:"p-4 bg-yellow-50 dark:bg-yellow-900/20 border border-yellow-200 dark:border-yellow-900 rounded-md mb-4",children:[e.jsxs("p",{className:"mb-3",children:["The other ",s.teams?"team":"player"," has submitted the following scores:"]}),e.jsxs("div",{className:"flex justify-center items-center text-center mb-4",children:[e.jsxs("div",{className:"text-center px-6",children:[e.jsx("p",{className:"text-sm",children:U().team1}),e.jsx("p",{className:"text-2xl font-bold",children:s.scores?.creator||s.scores?.team1||0})]}),e.jsx("div",{className:"text-xl font-bold mx-4",children:"-"}),e.jsxs("div",{className:"text-center px-6",children:[e.jsx("p",{className:"text-sm",children:U().team2}),e.jsx("p",{className:"text-2xl font-bold",children:s.scores?.opponent||s.scores?.team2||0})]})]}),e.jsx("p",{className:"mb-3",children:"Are these scores correct?"}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-3 sm:gap-4",children:[e.jsx("button",{onClick:()=>X(!0),disabled:m,className:`py-2 rounded-md font-medium ${m?"bg-gray-300 text-gray-500 cursor-not-allowed dark:bg-zinc-700 dark:text-zinc-400":"bg-green-600 text-white hover:bg-green-700"}`,children:m?"Processing...":"Confirm"}),e.jsx("button",{onClick:()=>X(!1),disabled:m,className:`py-2 rounded-md font-medium ${m?"bg-gray-300 text-gray-500 cursor-not-allowed dark:bg-zinc-700 dark:text-zinc-400":"bg-red-600 text-white hover:bg-red-700"}`,children:m?"Processing...":"Dispute"})]})]})]}),s.status==="completed"&&s.scores&&e.jsxs("div",{className:"mb-6",children:[e.jsx("h2",{className:"text-lg font-semibold mb-3",children:"Final Results"}),e.jsxs("div",{className:"p-4 rounded-md bg-blue-50 dark:bg-blue-900/20 border border-blue-200 dark:border-blue-900",children:[e.jsxs("div",{className:"flex justify-center items-center text-center mb-4",children:[e.jsxs("div",{className:"text-center px-6",children:[e.jsx("p",{className:"text-sm",children:U().team1}),e.jsx("p",{className:"text-3xl font-bold",children:s.scores.creator||s.scores.team1||0})]}),e.jsx("div",{className:"text-xl font-bold mx-4",children:"-"}),e.jsxs("div",{className:"text-center px-6",children:[e.jsx("p",{className:"text-sm",children:U().team2}),e.jsx("p",{className:"text-3xl font-bold",children:s.scores.opponent||s.scores.team2||0})]})]}),e.jsx("p",{className:"text-center font-medium",children:s.teams?"Team game completed":"Game completed"})]})]}),s.status==="waiting_confirmation"&&!g?.needsConfirmation&&e.jsx("div",{className:"p-4 bg-blue-50 dark:bg-blue-900/20 border border-blue-200 dark:border-blue-900 rounded-md mb-4",children:e.jsxs("p",{className:"text-center",children:["Waiting for ",g?.needsConfirmation?"you":"the other player"," to confirm the results."]})}),s.status==="in_progress"&&s.activePlayer&&e.jsxs("div",{className:`p-4 mb-4 rounded-md ${g?.isCurrentUserTurn?"bg-green-50 dark:bg-green-900/20 border border-green-200 dark:border-green-900":"bg-gray-50 dark:bg-gray-900/20 border border-gray-200 dark:border-gray-900"}`,children:[e.jsx("p",{className:"text-center font-medium",children:g?.isCurrentUserTurn?`It's your turn to play and submit the final scores${s.teams?" for your team":""}`:`Waiting for ${B()} to play and submit the final scores`}),g?.isCurrentUserTurn&&e.jsx("p",{className:"text-center text-sm mt-2 text-green-600 dark:text-green-400",children:"Play your game in person, then submit the final scores when finished"})]})]})}),e.jsx(Ue,{user:j,isOpen:de,onClose:ce,customStats:j?{gamesPlayed:j.stats.gamesPlayed,gamesWon:j.stats.gamesWon,totalPoints:j.stats.totalPoints,rank:j.stats.globalRank,winRate:j.stats.gamesPlayed>0?j.stats.gamesWon/j.stats.gamesPlayed*100:0}:void 0})]})},Oe=l.memo(De);export{Oe as default};
