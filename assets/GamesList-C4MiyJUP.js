import{r as s,i as le,H as oe,q as h,l as ie,X as ce,m as z,o as de,n as me,Y as K,Z as W,_ as V,I as Z,J as ue,K as ge,M as xe,j as e,$ as he,a0 as pe,a1 as fe,a2 as be,a3 as ye,P as q,a4 as b,C as R,a as M,b as U,d as P,s as ve,v as je,w as S,x as we,a5 as _,y as Ne,z as O,a6 as ke,a7 as Ce,a8 as Ie}from"./index-BJ8C48to.js";import{I as Re,A as G}from"./input-DovK2Ium.js";function Pe({title:u,titleId:i,...m},c){return s.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"currentColor","aria-hidden":"true","data-slot":"icon",ref:c,"aria-labelledby":i},m),u?s.createElement("title",{id:i},u):null,s.createElement("path",{d:"M5.85 3.5a.75.75 0 0 0-1.117-1 9.719 9.719 0 0 0-2.348 4.876.75.75 0 0 0 1.479.248A8.219 8.219 0 0 1 5.85 3.5ZM19.267 2.5a.75.75 0 1 0-1.118 1 8.22 8.22 0 0 1 1.987 4.124.75.75 0 0 0 1.48-.248A9.72 9.72 0 0 0 19.266 2.5Z"}),s.createElement("path",{fillRule:"evenodd",d:"M12 2.25A6.75 6.75 0 0 0 5.25 9v.75a8.217 8.217 0 0 1-2.119 5.52.75.75 0 0 0 .298 1.206c1.544.57 3.16.99 4.831 1.243a3.75 3.75 0 1 0 7.48 0 24.583 24.583 0 0 0 4.83-1.244.75.75 0 0 0 .298-1.205 8.217 8.217 0 0 1-2.118-5.52V9A6.75 6.75 0 0 0 12 2.25ZM9.75 18c0-.034 0-.067.002-.1a25.05 25.05 0 0 0 4.496 0l.002.1a2.25 2.25 0 1 1-4.5 0Z",clipRule:"evenodd"}))}const Se=s.forwardRef(Pe),Ge=(u,i,m,c,N,D)=>[{accessorKey:"formattedDate",header:({column:n})=>e.jsxs(b,{variant:"ghost",onClick:()=>n.toggleSorting(n.getIsSorted()==="asc"),className:"p-0 h-auto font-semibold hover:bg-transparent",children:["Date",e.jsx(G,{className:"ml-2 h-4 w-4"})]}),cell:({row:n})=>e.jsx("div",{className:"text-xs sm:text-sm whitespace-nowrap",children:n.getValue("formattedDate")})},{accessorKey:"opponentName",header:({column:n})=>e.jsxs(b,{variant:"ghost",onClick:()=>n.toggleSorting(n.getIsSorted()==="asc"),className:"p-0 h-auto font-semibold hover:bg-transparent",children:["Opponent",e.jsx(G,{className:"ml-2 h-4 w-4"})]}),cell:({row:n})=>{const l=n.original;return e.jsxs("div",{className:"font-medium text-xs sm:text-sm flex items-center space-x-2",children:[e.jsxs(ke,{className:"h-6 w-6 sm:h-8 sm:w-8",children:[e.jsx(Ce,{src:l.opponentPhotoURL||void 0,alt:l.opponentName}),e.jsx(Ie,{className:"text-xs",children:l.opponentInitials})]}),e.jsx("div",{className:"truncate max-w-20 sm:max-w-none",title:l.opponentName,children:l.opponentName})]})}},{accessorKey:"gameInfo",header:"Type",cell:({row:n})=>e.jsx("div",{className:"text-xs sm:text-sm text-gray-600 dark:text-gray-400 whitespace-nowrap capitalize",children:n.getValue("gameInfo")})},{accessorKey:"status",header:({column:n})=>e.jsxs(b,{variant:"ghost",onClick:()=>n.toggleSorting(n.getIsSorted()==="asc"),className:"p-0 h-auto font-semibold hover:bg-transparent",children:["Status",e.jsx(G,{className:"ml-2 h-4 w-4"})]}),cell:({row:n})=>{const l=n.original;return e.jsx("span",{className:`inline-block px-1.5 sm:px-2 py-0.5 sm:py-1 text-xs font-medium rounded-full ${l.statusColor}`,children:l.statusDisplay})}},{accessorKey:"result",header:"Result",cell:({row:n})=>{const l=n.getValue("result");return l?e.jsxs("span",{className:`inline-block px-1.5 sm:px-2 py-0.5 sm:py-1 text-xs font-medium rounded ${l==="Won"?"bg-green-100 text-green-800 dark:bg-green-900 dark:text-green-100":"bg-red-100 text-red-800 dark:bg-red-900 dark:text-red-100"}`,children:[l==="Won"?"W":"L",e.jsx("span",{className:"hidden sm:inline",children:l==="Won"?"on":"ost"})]}):null}},{accessorKey:"leagueName",header:"League",cell:({row:n})=>{const l=n.getValue("leagueName");return!l||l==="Individual"?e.jsx("span",{className:"text-xs sm:text-sm text-gray-500 dark:text-gray-400",children:"Individual"}):e.jsx("span",{className:"inline-block px-1.5 sm:px-2 py-0.5 sm:py-1 text-xs font-medium rounded-full bg-blue-100 text-blue-800 dark:bg-blue-900 dark:text-blue-100",children:l})}}],Me=s.memo(()=>e.jsxs("div",{className:"p-2 sm:p-4 lg:p-6 w-full lg:max-w-6xl lg:mx-auto",children:[e.jsx("h1",{className:"sr-only",children:"My Games"}),e.jsxs(R,{children:[e.jsx(M,{children:e.jsx(U,{className:"text-xl sm:text-2xl",children:"My Games"})}),e.jsx(P,{className:"flex justify-center",children:e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-t-2 border-b-2 border-blue-500"})})]})]})),Ue=s.memo(({onNavigateHome:u})=>e.jsxs("div",{className:"p-2 sm:p-4 lg:p-6 w-full lg:max-w-6xl lg:mx-auto",children:[e.jsx("h1",{className:"sr-only",children:"My Games"}),e.jsxs(R,{children:[e.jsx(M,{children:e.jsx(U,{className:"text-xl sm:text-2xl",children:"My Games"})}),e.jsxs(P,{className:"text-center",children:[e.jsx("p",{className:"mb-4",children:"Please sign in to view your games."}),e.jsx(b,{onClick:u,children:"Go to Home"})]})]})]})),De=s.memo(({isInActiveGame:u,onCreateGame:i})=>e.jsx(R,{children:e.jsxs(P,{className:"text-center pt-6",children:[e.jsx("p",{className:"mb-4",children:"You don't have any games yet."}),e.jsx(q,{to:"/create-game",className:`inline-block ${u?"pointer-events-none opacity-50":""}`,onClick:i,children:e.jsx(b,{disabled:u,children:"Create Your First Game"})})]})})),Ae=({refreshNotifications:u})=>{const i=le(),[m,c]=s.useState({games:[],loading:!0,error:null,isRefreshing:!1}),[N,D]=s.useState({}),[n,l]=s.useState({}),[Q,w]=s.useState(null),[p,A]=s.useState(!1),[J,X]=s.useState([]),[ee,ae]=s.useState([]),[L,F]=s.useState(""),B=s.useCallback(async a=>{if(a.length===0)return{};try{const t=a.map(async x=>{const j=await oe(x);return j?{id:x,name:j.name}:null}),r=(await Promise.all(t)).filter(Boolean),d={};return r.forEach(x=>{d[x.id]=x.name}),d}catch(t){return console.error("Error fetching league names:",t),{}}},[]),f=s.useCallback(async()=>{if(!h.currentUser){i("/");return}try{c(o=>({...o,isRefreshing:!0}));const[a,t]=await Promise.all([ie(),ce(h.currentUser.uid)]);c(o=>({...o,games:a})),A(t);const r=new Set;a.forEach(o=>{r.add(o.createdBy),r.add(o.opponent)});const d=z(),x=Array.from(r).map(async o=>{const v=de(d,"users",o),$=await me(v);return $.exists()?{uid:o,profile:$.data()}:null}),j=(await Promise.all(x)).filter(Boolean),k={};j.forEach(o=>{k[o.uid]=o.profile}),D(k);const I=Array.from(new Set(a.map(o=>o.leagueId).filter(Boolean)));if(I.length>0){const o=await B(I);l(o)}u&&u()}catch(a){console.error("Error fetching games:",a),c(t=>({...t,error:"Failed to load your games"}))}finally{c(a=>({...a,isRefreshing:!1}))}},[i,u,B]);s.useEffect(()=>{const a=h.currentUser;if(!a)return;(async()=>{c(v=>({...v,loading:!0})),await f(),c(v=>({...v,loading:!1}))})();const r=z(),d=K(V(r,"games"),W("createdBy","==",a.uid)),x=K(V(r,"games"),W("opponent","==",a.uid));let j=0;const k=()=>{const v=Date.now();v-j>2e3&&(j=v,f())},I=Z(d,k),o=Z(x,k);return()=>{I(),o()}},[]);const E=s.useCallback(a=>{if(!a)return"Unknown date";if(typeof a=="object"&&a!==null&&"toDate"in a&&typeof a.toDate=="function")return a.toDate().toLocaleDateString();if(a instanceof Date)return a.toLocaleDateString();if(typeof a=="number"||typeof a=="string")try{return new Date(a).toLocaleDateString()}catch{return"Invalid date"}return"Unknown date format"},[]);s.useCallback(a=>{const r=h.currentUser?.uid===a.createdBy?a.opponent:a.createdBy;return N[r]?.displayName||"Unknown player"},[N]);const T=s.useCallback(a=>{const r=h.currentUser?.uid===a.createdBy?a.opponent:a.createdBy,d=N[r];return{name:d?.displayName||"Unknown player",photoURL:d?.photoURL||null,initials:d?.displayName?d.displayName.substring(0,2).toUpperCase():"UP"}},[N]),C=s.useMemo(()=>m.games.map(a=>{h.currentUser?.uid,a.createdBy;const t=T(a),d={invited:a.opponent===h.currentUser?.uid?{display:"New Invitation",color:"bg-amber-100 text-amber-800 dark:bg-amber-900 dark:text-amber-100 animate-pulse"}:{display:"Awaiting Response",color:"bg-blue-100 text-blue-800 dark:bg-blue-900/20 dark:text-blue-300"},accepted:{display:"Ready to Play",color:"bg-green-100 text-green-800 dark:bg-green-900 dark:text-green-100"},in_progress:{display:"ðŸ”¥ In Progress",color:"bg-gradient-to-r from-green-400 to-green-600 text-white dark:from-green-500 dark:to-green-700 animate-pulse shadow-lg border border-green-300"},waiting_confirmation:{display:"Waiting Confirmation",color:"bg-yellow-100 text-yellow-800 dark:bg-yellow-900 dark:text-yellow-100"},completed:{display:"Completed",color:"bg-gray-100 text-gray-800 dark:bg-gray-900 dark:text-gray-100"},rejected:{display:"Rejected",color:"bg-red-100 text-red-800 dark:bg-red-900 dark:text-red-100"}}[a.status]||{display:a.status,color:"bg-gray-100 text-gray-800 dark:bg-gray-900 dark:text-gray-100"},x=a.status==="completed"&&a.winner?a.winner===h.currentUser?.uid?"Won":"Lost":null;return{...a,opponentName:t.name,opponentPhotoURL:t.photoURL,opponentInitials:t.initials,formattedDate:E(a.createdAt),statusDisplay:d.display,statusColor:d.color,gameInfo:a.settings.gameMode==="single"?"Individual":"Teams",result:x,leagueName:a.leagueId?n[a.leagueId]||"League Game":"Individual"}}),[m.games,T,E,n]),te=s.useCallback(async a=>{if(p){c(t=>({...t,error:"You cannot accept this invitation because you're already in an active game"}));return}try{w(a),await ue(a)&&(await f(),A(!0))}catch{c(r=>({...r,error:"Failed to accept game invitation"}))}finally{w(null)}},[p,f]),se=s.useCallback(async a=>{try{w(a),await ge(a)&&await f()}catch{c(r=>({...r,error:"Failed to reject game invitation"}))}finally{w(null)}},[f]),re=s.useCallback(async a=>{try{w(a),await xe(a)&&(await f(),i(`/game/${a}`))}catch{c(r=>({...r,error:"Failed to start the game"}))}finally{w(null)}},[f,i]),ne=s.useCallback(()=>i("/"),[i]),Y=s.useCallback(a=>{p&&(a.preventDefault(),alert("You cannot create a new game while you have an active game"))},[p]),H=s.useMemo(()=>Ge(),[te,se,re,Q,p,i]),g=he({data:C,columns:H,onSortingChange:X,onColumnFiltersChange:ae,onGlobalFilterChange:F,getCoreRowModel:ye(),getPaginationRowModel:be(),getSortedRowModel:fe(),getFilteredRowModel:pe(),globalFilterFn:"includesString",state:{sorting:J,columnFilters:ee,globalFilter:L}}),y=s.useMemo(()=>{const a=C.filter(r=>r.status==="invited"&&r.opponent===h.currentUser?.uid),t=C.filter(r=>r.status==="in_progress");return{hasNewInvitations:a.length>0,hasInProgressGames:t.length>0,inProgressCount:t.length}},[C]);return m.loading?e.jsx(Me,{}):h.currentUser?e.jsxs("div",{className:"p-2 sm:p-4 lg:p-6 w-full lg:max-w-6xl lg:mx-auto",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row sm:justify-between sm:items-center mb-6 space-y-4 sm:space-y-0",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center space-y-2 sm:space-y-0",children:[e.jsxs("h1",{className:"text-xl sm:text-2xl font-bold flex items-center",children:["My Games",y.hasNewInvitations&&e.jsxs("span",{className:"ml-3 inline-flex items-center",children:[e.jsx(Se,{className:"h-5 w-5 text-amber-500 animate-bounce"}),e.jsx("span",{className:"ml-1 text-sm font-medium text-amber-600",children:"New Invitations!"})]}),y.hasInProgressGames&&e.jsxs("span",{className:"ml-3 inline-flex items-center",children:[e.jsxs("div",{className:"relative",children:[e.jsx("div",{className:"h-3 w-3 bg-green-500 rounded-full animate-pulse"}),e.jsx("div",{className:"absolute top-0 left-0 h-3 w-3 bg-green-400 rounded-full animate-ping opacity-75"})]}),e.jsxs("span",{className:"ml-2 text-sm font-medium text-green-600 dark:text-green-400",children:[y.inProgressCount," Game",y.inProgressCount>1?"s":""," in Progress"]})]})]}),e.jsx("div",{className:"flex items-center",children:e.jsx("button",{onClick:f,disabled:m.isRefreshing,className:"md:ml-3 p-1 rounded-full text-gray-500 hover:bg-gray-100 hover:text-gray-700 dark:text-gray-400 dark:hover:bg-gray-800 dark:hover:text-gray-300",title:"Refresh games list",children:e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor",className:`w-5 h-5 ${m.isRefreshing?"animate-spin":""}`,children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M16.023 9.348h4.992v-.001M2.985 19.644v-4.992m0 0h4.992m-4.993 0 3.181 3.183a8.25 8.25 0 0 0 13.803-3.7M4.031 9.865a8.25 8.25 0 0 1 13.803-3.7l3.181 3.182m0-4.991v4.99"})})})})]}),e.jsx(q,{to:"/create-game",className:`inline-block ${p?"pointer-events-none opacity-50":""}`,onClick:Y,children:e.jsx(b,{disabled:p,className:"bg-blue-600 text-white hover:bg-blue-700",children:"Create New Game"})})]}),m.error&&e.jsxs("div",{className:"mb-6 p-4 bg-red-100 border border-red-400 text-red-700 rounded-md flex justify-between items-center",children:[e.jsx("div",{children:m.error}),e.jsx(b,{variant:"outline",size:"sm",onClick:()=>c(a=>({...a,error:null})),className:"ml-4 text-red-700 hover:text-red-800",children:"Dismiss"})]}),m.isRefreshing&&!m.loading&&e.jsxs("div",{className:"mb-6 p-4 bg-blue-100 border border-blue-400 text-blue-800 rounded-md flex items-center",children:[e.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-t-2 border-b-2 border-blue-800 mr-2"}),e.jsx("span",{children:"Refreshing games..."})]}),p&&e.jsxs("div",{className:"mb-6 p-4 bg-blue-100 border border-blue-400 text-blue-800 rounded-md",children:[e.jsx("p",{className:"font-medium",children:"You currently have an active game."}),e.jsx("p",{children:"You must complete your active game before creating or joining a new one."})]}),y.hasInProgressGames&&e.jsx("div",{className:"mb-6 p-4 bg-green-50 border border-green-200 text-green-800 dark:bg-green-900/20 dark:border-green-900 dark:text-green-200 rounded-md",children:e.jsxs("div",{className:"flex items-center",children:[e.jsxs("div",{className:"relative mr-3",children:[e.jsx("div",{className:"h-4 w-4 bg-green-500 rounded-full animate-pulse"}),e.jsx("div",{className:"absolute top-0 left-0 h-4 w-4 bg-green-400 rounded-full animate-ping opacity-75"})]}),e.jsxs("div",{children:[e.jsxs("p",{className:"font-medium",children:[y.inProgressCount," game",y.inProgressCount>1?"s":""," currently in progress!"]}),e.jsx("p",{className:"text-sm",children:y.inProgressCount===1?"Your game is active. Click on it to continue playing.":"You have multiple active games. Click on any to continue playing."})]})]})}),m.games.length===0?e.jsx(De,{isInActiveGame:p,onCreateGame:Y}):e.jsxs(R,{children:[e.jsx(M,{children:e.jsx(U,{children:"All Games"})}),e.jsx(P,{children:e.jsxs("div",{className:"w-full",children:[e.jsxs("div",{className:"flex items-center md:flex-row flex-col-reverse py-4",children:[e.jsx(Re,{placeholder:"Search games by opponent name, status...",value:L??"",onChange:a=>F(String(a.target.value)),className:"max-w-sm"}),e.jsxs("div",{className:"ml-auto text-sm text-muted-foreground",children:[g.getFilteredRowModel().rows.length," of"," ",g.getCoreRowModel().rows.length," games"]})]}),e.jsx("div",{className:"overflow-hidden rounded-md border",children:e.jsxs(ve,{children:[e.jsx(je,{children:g.getHeaderGroups().map(a=>e.jsx(S,{children:a.headers.map(t=>{const r=t.column.id==="gameInfo";return e.jsx(we,{className:r?"hidden sm:table-cell":"",children:t.isPlaceholder?null:_(t.column.columnDef.header,t.getContext())},t.id)})},a.id))}),e.jsx(Ne,{children:g.getRowModel().rows?.length?g.getRowModel().rows.map(a=>e.jsx(S,{className:"cursor-pointer hover:bg-gray-50 dark:hover:bg-zinc-700/50",onClick:()=>i(`/game/${a.original.id}`),children:a.getVisibleCells().map(t=>{const r=t.column.id==="gameInfo";return e.jsx(O,{className:r?"hidden sm:table-cell":"",children:_(t.column.columnDef.cell,t.getContext())},t.id)})},a.id)):e.jsx(S,{children:e.jsx(O,{colSpan:H.length,className:"h-24 text-center",children:"No games found."})})})]})}),e.jsxs("div",{className:"flex items-center justify-end space-x-2 py-4",children:[e.jsxs("div",{className:"text-muted-foreground flex-1 text-sm",children:["Page ",g.getState().pagination.pageIndex+1," of"," ",g.getPageCount()]}),e.jsxs("div",{className:"space-x-2",children:[e.jsx(b,{variant:"outline",size:"sm",onClick:()=>g.previousPage(),disabled:!g.getCanPreviousPage(),children:"Previous"}),e.jsx(b,{variant:"outline",size:"sm",onClick:()=>g.nextPage(),disabled:!g.getCanNextPage(),children:"Next"})]})]})]})})]})]}):e.jsx(Ue,{onNavigateHome:ne})},Be=s.memo(Ae);export{Be as default};
